@model BankLoanSystem.Models.AdvanceUnit

@*<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>*@

@*<link rel="stylesheet" href="~/Content/commonActions.css">
<link href="~/Content/pikaday.css" rel="stylesheet" />
<link href="~/Content/theme.css" rel="stylesheet" />
<link href="~/Content/triangle.css" rel="stylesheet" />*@

@section AddToHead{
   <style>

    #thumbnail img {
        cursor: pointer;
    }

    #large {
        display: none;
        position: absolute;
        background: #FFFFFF;
        padding: 5px;
        z-index: 10;
        min-height: 200px;
        min-width: 200px;
        color: #336699;
    }

    #background {
        display: none;
        position: absolute;
        height: 100%;
        width: 100%;
        top: 0;
        left: 0;
        background: #000000;
        z-index: 1;
    }

      #checkableGridDiv table tbody,
#checkableGridDiv table thead { display: block; }

#checkableGridDiv table tbody {
    max-height: 300px;
    overflow-y: auto;
    overflow-x: hidden;
}

.right-panel>.side-panel{
    margin-top: 10px;
}
.col-md-2{
    text-align:left;
}
 .gridtable {

        width: 97.5%;
        
    }
 input[type="button"]:disabled { background-color: #d9d9d9; cursor: default; } 

 #searchDiv .col-md-2{
     width: 17%;
    padding: unset;
    padding-left: 13px;
 }
 /*.popup9 > fieldset > div{
     display: inline-block;

 }*/
</style>

}
<script src="~/scripts/moment.js"></script>
<script src="~/scripts/pikaday.js"></script>
<script src="~/Scripts/jquery.validate.min.js?version=@((new Random()).Next(1,10000))"></script>
<script src="~/Scripts/jquery.validate.unobtrusive.min.js?version=@((new Random()).Next(1,10000))."></script>
@{
    ViewBag.Title = "Advance Unit";
    Layout = "~/Views/Shared/_DashBoardLayout.cshtml";
    WebGrid grid = new WebGrid(Model.NotAdvanced, defaultSort: "CreatedDate", canPage: false, ajaxUpdateContainerId: "checkableGridDiv", ajaxUpdateCallback: "GridUpdate");/**/

}

<head>
    <title>jQuery: Image preview in popup with Grey out background</title>
    <script type="text/javascript" language="javascript">
	jQuery.fn.center = function () {
		this.css("position","absolute");
		this.css("top", ( $(window).height() - this.height() ) / 2+$(window).scrollTop() + "px");
		this.css("left", ( $(window).width() - this.width() ) / 2+$(window).scrollLeft() + "px");
		return this;
	}

	$(document).ready(function() {
		$("#thumbnail img").click(function(e){

			$("#background").css({"opacity" : "0.7"})
							.fadeIn("slow");

			$("#large").html("<img src='"+$(this).parent().attr("href")+"' alt='"+$(this).attr("alt")+"' /><br/>"+$(this).attr("rel")+"")
					   .center()
					   .fadeIn("slow");

			return false;
		});

		$(document).keypress(function(e){
			if(e.keyCode==27){
				$("#background").fadeOut("slow");
				$("#large").fadeOut("slow");
			}
		});

		$("#background").click(function(){
			$("#background").fadeOut("slow");
			$("#large").fadeOut("slow");
		});

		$("#large").click(function(){
			$("#background").fadeOut("slow");
			$("#large").fadeOut("slow");
		});

	});
    </script>
    
</head>






    @{Html.RenderAction("LoanInfo", "Unit", new { title = @ViewBag.Title, msg = @ViewBag.Msg });
    }
    <div class="container" id="container">

<div class="body-content" style="width:100%;float:none">
    @if (Model.NotAdvanced.Count == 0)
    {
        <div id="noUnitLabelDiv" class="info-unit" style="float: unset;margin-top:15px; font:medium;color:red;margin-right:unset" hidden>
            @*@Html.Label("No units to Advance could be found.", htmlAttributes: new { @class = "control-label col-sm-8", @style = "float:unset;" })*@
            <label>No units to Advance could be found.</label>
        </div>
    }
    else
    {
    <div class ="info-unit" id ="checkableGridDiv" style="padding: 1px 30px 30px 0px;">
        <div>
            @grid.GetHtml(
            tableStyle: "gridtable",
           headerStyle: "webgrid-header",

           alternatingRowStyle: "webgrid-alternating-row",
           rowStyle: "webgrid-row-style",
           htmlAttributes: new { id = "checkableGrid" },
           columns: grid.Columns(
           grid.Column( style: "gridColumnSelect",
                format:@<text><input type="checkbox" value="@item.UnitId" name="ids" class="checkboxAll" id="all"/></text>
                   , header: "{checkall}"

           ),
                grid.Column(
                   "CreatedDate",
                   "Date Entered", style: "gridColumnOthers",
                   format: (item) => string.Format("{0:MM/dd/yyyy}", item.CreatedDate)
               ),
           grid.Column("VIN/HIN/serial #", "VIN/HIN/serial #", canSort: false, style: "gridColumnVIN", format: @<text>@{<label id="vin" class="vin">@item.IdentificationNumber</label>}</text>),
                grid.Column("Year", "Year", style: "gridColumnSmall", format:@<text>@{<label id="year" class="year">@item.Year</label>}</text>),
                grid.Column("Make", "Make", style: "gridColumnOthers", format:@<text>@{<label id="make" class="make">@item.Make</label>}</text>),
               grid.Column("Model", "Model", style: "gridColumnOthers", format:@<text>@{<label id="model" class="model">@item.Model</label>}</text>),
               grid.Column("Cost", "Cost ($)", style: "gridColumn", format:@<text>@{<label id="cost" class="cost">@Convert.ToDecimal(item.Cost).ToString("#,##0.00")</label>}</text>),
                grid.Column("Advance Amount", "Advance Amount ($)", canSort: false, style: "gridColumn", format:@<text>@{<label id="am" class="advanceAmount">@Convert.ToDecimal(item.AdvanceAmount).ToString("#,##0.00")</label>}</text>)

               )
)
            
        </div>
        
        <div>
            <span id="subtotal" style="margin-right:5px;float: right;text-align:right;font-weight:bold;"> Current Total to Advance : $ 0.00  </span>
        </div>
        
        <div id="unitid" class="hidden"></div>
    </div>
    }
        <div id="unitid" style="clear:both" class="hidden"></div>
    </div>

    <div class="right-panel">
        @{
            Html.RenderAction("LoanPaymentDetails", "Unit");
        }

        @if(Session["AdvItems"] != null) {
            <div>
                <a href='/AdvanceUnit/AdvanceUnitReport' value="Report" class="btn btn-primary m-b cancel next_clear_button back_back" target="_blank"   style="margin-top: 12px;"><span class="icon-stack"></span>Report</a></div>
             
        }
    </div>

    <div class ="info-unit" id="advanceAllDiv" style="margin-top:10px;width:79%">
        <div class="form-group">
            <div class="control-label col-sm-2" style="text-align:right;padding-top:5px">
                @Html.Label("AdvanceDate", htmlAttributes: new { })
            </div>
            <div class="col-xs-3" id="advanceDateAll" style="width:30%">
                @Html.EditorFor(model => model.AdvanceDate, new { htmlAttributes = new { @class = "form-control dateKeyPressValidate", @id = "startDate", autocomplete = "off", @disabled = "disabled" , placeholder = "MM/DD/YYYY" , maxlength = 10, @Style = "width:165px" } })
                <span class="text-danger field-validation-error" id="errorStartDate" style="left:7%"></span>
        </div>
            <input type="button" value="Advance all selected items" id="btnAdvanceAll" class="btn btn-primary m-b next_clear_button next_back" style="margin-left:60px;width:200px;margin-top:0px;margin-left: -185px;" disabled/>
        </div>
    </div>


<div class="info-unit" id="searchDiv" style="margin-top:10px;width:79%;padding-top:10px;padding-bottom: 18px;">
    
    <div class="row">
        <div class="col-xs-12" style="padding:unset;">
            <form>
                <fieldset>
                    <div class="form-group row">
                        
                        <div class="col-md-2">
                            <label for="">VIN/HIN/Serial</label>
                            @Html.EditorFor(model => model.IdentificationNumber, new { htmlAttributes = new { @class = "form-control", @id = "identificationNumberSearch", @placeholder = "Last 6 of VIN/HIN/SN", @maxlength = "6",@Style="width:165px" } })
                            @*@Html.ValidationMessageFor(model => model.IdentificationNumber, "", new { @class = "text-danger" })*@
                            <span class="text-danger field-validation-error" id="searchIdentificationNumber" style="width:205px"></span>
                        </div>
                        
                           
                        
                        
                        <div class="col-md-2" id="div-combobox1-1" style="margin-left:60px">
                            <label for="">Year</label>
                            @{
                                List<SelectListItem> yearList = new List<SelectListItem>();
                                foreach (var type in ViewBag.advanceList)
                                {
                                    if (!yearList.Exists(a => a.Value == type.Year.ToString()) && type.Year.ToString() != "")
                                    {
                                        yearList.Add(new SelectListItem { Text = type.Year.ToString(), Value = type.Year.ToString() });
                                    }
                                }
                            }
                             @Html.DropDownList("year", yearList, "--Select--", new { @class = "form-control", @id = "cmbYear"})
                            @*@Html.ValidationMessageFor(model => model.vehicle.Year, "", new { @class = "text-danger" })*@
                                    @*<div id="vehicleyear"><span class="text-danger"></span></div>*@

                        </div>
                        <div class="col-md-2" id="div-combobox1-2" style="margin-left:1px">
                            <label for="">Make</label>
                            @{List<SelectListItem> makeList = new List<SelectListItem>();
                                foreach (var type in ViewBag.advanceList)
                                {
                                    if (!makeList.Exists(a => a.Value == type.Make.ToString()) && type.Make.ToString() != "")
                                    {
                                        makeList.Add(new SelectListItem { Text = type.Make.ToString(), Value = type.Make.ToString() });
                                    }
                                }
                            }

                        @Html.DropDownList("make", makeList, "-- Select--", new { @class = "form-control", @id = "cmbMake" })
                        @*@Html.ValidationMessageFor(model => model.vehicle.Make, "", new { @class = "text-danger col-md-2" })*@
                        @*<div id="vehiclemake"><span class="text-danger"></span></div>*@

                        </div>
                        <div class="col-md-2" id="div-combobox1-3" style="margin-left:1px">
                            <label for="">Model</label>
                            @{List<SelectListItem> modelList = new List<SelectListItem>();
                                foreach (var type in ViewBag.advanceList)
                                {
                                    if (!modelList.Exists(a => a.Value == type.Model.ToString()) && type.Model.ToString() != "")
                                    {
                                        modelList.Add(new SelectListItem { Text = type.Model.ToString(), Value = type.Model.ToString() });
                                    }
                                }
                            }

                                            @Html.DropDownList("model", modelList, "--Select--", new { @class = "form-control", @id = "cmbModel" })
                                            @*@Html.ValidationMessageFor(model => model.vehicle.Model, "", new { @class = "text-danger" })*@
                                            @*<div id="vehiclemodel"><span class="text-danger"></span></div>*@
                        </div>
                        <button type="button" class="btn btn-primary m-b cancel next_clear_button back_back" id="btnSearch" style="">Search</button>
                        <button type="button" class="btn btn-primary m-b next_clear_button clear_back" id="btnClear" tabindex="-1" style="">Clear</button>
                </div>
                        </fieldset>
            </form>
        </div>
    </div>
    </div>


<div class="form-horizontal" style="margin-bottom:10px;margin-top:10px">
    <div class="info-unit" id="searchGrid1" style="margin-top:10px;padding-top:10px;padding-bottom: 10px;padding-right: 30px;padding-left: 10px;">


    </div>
</div>
<div class="info-unit" id="singleUnitDiv" hidden style="margin-bottom:1%">
    <div class="row">
        <div class="col-xs-12">
            <form>
                <fieldset>
                    
                    <div class="form-group row">
                        <div class="col-md-2">
                            <label>VIN/HIN/Serial</label>
                            @Html.Editor("iVin", new { @id = "iVin", htmlAttributes = new { @class = "form-control", @disabled = "disabled",@Style= "width:210px" } })
                        </div>
                        <div class="col-md-2" style="margin-left:90px">
                            <label>Year</label>
                            @Html.Editor("iYear", new { @id = "iYear", htmlAttributes = new { @class = "form-control", @disabled = "disabled" } })
                        </div>
                        <div class="col-md-2">
                            <label>Make</label>
                            @Html.Editor("iMake", new { @id = "iMake", htmlAttributes = new { @class = "form-control", @disabled = "disabled" } })
                        </div>
                        <div class="col-md-2" style="margin-right:2px">
                            <label>Model</label>
                            @Html.Editor("iModel", new { @id = "iModel", htmlAttributes = new { @class = "form-control", @disabled = "disabled", @Style = "width:175px" } })
                        </div>
                       
                        </div>
                    <div class="form-group row" style="margin-top:15px !important">

                        <div class="col-md-2">
                            <label>Price</label>
                            @Html.Editor("iCost", new { @id = "iCost", htmlAttributes = new { @class = "form-control", @disabled = "disabled", style = "text-align:right;" } })
                        </div>
                        <div class="col-md-2" style="margin-left: 92px;">
                            <label>Advance Amount</label>
                            @Html.Editor("iAdvance", new { @id = "iAdvance", htmlAttributes = new { @class = "form-control", @disabled = "disabled", style = "text-align:right;" } })
                               <div id="tagscloud"><span class="text-danger field-validation-error" id="errorAdvanceAmount"></span></div>
                        </div>
                        <div class="col-md-2">
                            <label>Advance Date</label>
                            @Html.EditorFor(model => model.AdvanceDate, new { htmlAttributes = new { @class = "form-control dateKeyPressValidate", @placeholder = "MM/DD/YYYY", @id = "advanceDate", autocomplete = "off", @disabled = "disabled" , maxlength = 10 } })
                            <span class="text-danger field-validation-error" id="errorAdvanceDate" style=""></span>
                        </div>
                    </div>
                    @if (ViewBag.isLender == true)
                    {
                        <div class="form-group row" style="margin-top:15px !important">

                            <div class="col-md-2">
                                <input type="button" id="titleShow" class="btn btn-primary titleView" value="View Titles"/>
                            </div>
                        </div>
                    }
                    <input type="button" value="Cancel" id="btnCancel" tabindex="-1" class="btn btn-primary m-b next_clear_button clear_back" style="float:right;width:130px;margin-right: 185px;margin-left: -190px;margin-top: 40px;" />

                    <input type="button" name="Advance" value="Advance" id="btnAdvance" class="btn btn-primary m-b next_clear_button next_back" style="width:130px;margin-top: 40px;margin-left: 40px;"disabled />
                    </fieldset>
                
                </form>
            </div>
        </div>
                    </div>

    </div>

   
    <div class="link-bar" style="margin-bottom:15px;">


        @{
            Html.RenderAction("GetLinkBar", "Unit");
        }


    </div>



<script src="~/scripts/CommonFunctions.js"></script>


<script type="text/javascript">

    var browser = navigator.userAgent.toLowerCase();

    if (/chrom(e|ium)/.test(navigator.userAgent.toLowerCase())) {
        $('head').append('<style>#btnSearch{    margin-left:-8px; margin-top: 19px;margin-bottom: 0px;margin-right: 0px;        }#btnClear{ margin-top: 19px;margin-bottom: 0px;margin-right: 0px;  }</style>');
    } else if ((browser.indexOf('firefox') > -1)) {
        $('head').append('<style>#btnSearch{    margin-left:-8px; margin-top: 19px;margin-bottom: 0px;margin-right: 0px;        }#btnClear{ margin-top: 19px;margin-bottom: 0px;margin-right: 0px;  }</style>');
    } else if (browser.indexOf('msie') > 0 || !!navigator.userAgent.match(/Trident.*rv\:11\./)) {
        $('head').append('<style>#btnSearch{    margin-left:-8px; margin-top: 28px;margin-bottom: 0px;margin-right: 0px;        }#btnClear{ margin-top: 28px;margin-bottom: 0px;margin-right: 0px;  }</style>');

    }

    $("#lkadv").hide();

    $('#advanceDate').focusout(function () {
        $(this).attr('placeholder', 'MM/DD/YYYY');
    });
    // Change the selector if needed
    var table = $('table'),
        bodyCells = table.find('tbody tr:first').children(),
        colWidth;

    // Get the tbody columns width array
    colWidth = bodyCells.map(function () {
        return $(this)[0].getBoundingClientRect().width;
    }).get();

    // Set the width of thead columns
    table.find('thead tr').children().each(function (i, v) {
        $(v).outerWidth(colWidth[i]);
    });

    // Adjust the width of thead cells when window resizes
    $(window).resize(function () {
        // Get the tbody columns width array
        colWidth = bodyCells.map(function () {
            return $(this)[0].getBoundingClientRect().width;
        }).get();

        // Set the width of thead columns
        table.find('thead tr').children().each(function (i, v) {
            $(v).outerWidth(colWidth[i]);
        });
    }).resize(); // Trigger resize handler

    $(window).bind("load", function () {

        // Get the tbody columns width array
        colWidth = bodyCells.map(function () {
            return $(this)[0].getBoundingClientRect().width;
        }).get();

        // Set the width of thead columns
        table.find('thead tr').children().each(function (i, v) {
            $(v).outerWidth(colWidth[i]);
        });
    });


    function onlyDotsAndNumbers(event) {
        var charCode = (event.which) ? event.which : event.keyCode
        if (charCode == 46) {
            return true;
        }
        if (charCode > 31 && (charCode < 48 || charCode > 57))
            return false;

        return true;
    };
    //block invalid characters
    $("#identificationNumberSearch").keypress(function (e) {

        var ch = e.which;
        if ((ch >= 47 && ch <= 57) || (ch >= 65 && ch <= 90) || (ch >= 97 && ch <= 122)) {
            return 1;
        }

        else {
            e.preventDefault();
        }
        //alert(ch);
    });
    //capitalize letters when typing
    $('#identificationNumberSearch').keyup(function () {
        $('#identificationNumberSearch').val(($('#identificationNumberSearch').val()).toUpperCase());
    });
    $("#btnCancel").click(function () {
        ClearTextBoxValues();

        total = 0;
        checkCount = 0;
        $("#btnAdvance").attr("disabled", "disabled");
        $("#btnAdvanceAll").attr("disabled", "disabled");
        $("#advanceDate").attr("disabled", "disabled");
        $("#startDate").attr("disabled", "disabled");
        $("#iAdvance").attr("disabled", "disabled");

        var count = 0;
        $("#checkableGrid").find("input:checkbox").each(function () {
            this.checked = false;
            if (count > 0) {
                $(this).parents('tr').css('background', 'transparent');
            }
            count++;
        });
        document.getElementById('all').checked = false;
        var num =roundNumber(total,2);
        document.getElementById("subtotal").innerHTML = "Current Total to Advance : $ " + num;

        $("#someID span").html('Select');
        $("#tagscloud span").html('');
        $('#iAdvance').removeClass('input-validation-error');
        $('#startDate').val('');
        $('#startDate').removeClass('input-validation-error');
        $('#errorStartDate').text('');
        $('#startDate').attr('placeholder', 'MM/DD/YYYY');

        ClearSearchRelatedData();

    });

    $("#btnClear").click(function () {

        ClearSearchRelatedData();
        var mainGridSelectedCount = 0;
        $('table#checkableGrid > tbody > tr').each(function () {
            var isChecked = $(this).find("#all").is(':checked');
            if (isChecked === true)
                mainGridSelectedCount = mainGridSelectedCount + 1;
        });

        if (mainGridSelectedCount === 0)
            ClearTextBoxValues();
    });

    function ClearSearchRelatedData() {
        //document.getElementById("form").reset();
        $("#identificationNumberSearch").val('');
        $("#vehicleModelSearch").val('');
        $('#cmbYear').val('');
        $("#cmbMake").val('');
        $("#cmbModel").val('');
        $("#noDataLabelDiv").hide();
        $("#searchIdentificationNumber").text('');
        $('#identificationNumberSearch').removeClass('input-validation-error');
        $("#searchGrid1").hide();

    }

    $("#btnSearch").click(function () {

        ClearTextBoxValues();

        total = 0;
        checkCount = 0;
        $("#btnAdvance").attr("disabled", "disabled");
        $("#btnAdvanceAll").attr("disabled", "disabled");
        $("#advanceDate").attr("disabled", "disabled");
        $("#startDate").attr("disabled", "disabled");
        $("#iAdvance").attr("disabled", "disabled");
        ClearMainGrid();
        document.getElementById('all').checked = false;
        document.getElementById("subtotal").innerHTML = "Current Total to Advance : $ " + roundNumber(total,2);

        $("#someID span").html('Select');
        $("#tagscloud span").html('');
        $('#iAdvance').removeClass('input-validation-error');
        var para1 = $("#identificationNumberSearch").val();
        var para2 = $('#cmbYear').val();
        var para3 = $("#cmbMake").val();
        var para4 = $("#cmbModel").val();
        if (para1 == null) { para1 = ''; }
        if (((para1 != "") &&(para1 != null)) && (para1.length < 6)) {
            //alert('ff');
            $("#searchIdentificationNumber").text('Please confirm the last 6 characters of the VIN/HIN/Serial No.');
            //$('#identificationNumberSearch').val("");

            $('.centered span').text('Error');
            $('#identificationNumberSearch').addClass('input-validation-error')
            $('#searchGrid1').hide()
            e.preventDefault();

        }
        else if (($("#identificationNumberSearch").val() != '') || ($('#cmbYear').val() != '') || ($('#cmbMake').val() != '') || ($("#cmbModel").val() != '')) {
            Search(para1, para2, para3, para4);
        } else {
            $('#searchGrid1').hide();
        }


    });
    $('#identificationNumberSearch').click(function () {
        $("#searchIdentificationNumber").text('');
        // $('#identificationNumberSearch').val("");

        $('.centered span').text('');
        $('#identificationNumberSearch').removeClass('input-validation-error');
       
    });
    function ClearMainGrid() {
        var count = 0;
        $("#checkableGrid").find("input:checkbox").each(function () {
            this.checked = false;
            if (count > 0) {
                $(this).parents('tr').css('background', 'transparent');
            }
            count++;
        });

        total = 0;
        checkCount = 0;
        document.getElementById("subtotal").innerHTML = "Current Curtailment Total : $ " + roundNumber(total, 2);
        $("#payAll").attr("disabled", "disabled");
        $("#payDate").attr("disabled", "disabled");

        // clear top error
        $('.centered span').text('');
        $('#errorStartDate').text("");
        $('#errorStartDate').removeClass("field-validation-error");
        $('#startDate').removeClass("input-validation-error");

                            
        //$('#errorPayDate').text('');
        //$('#payDate').removeClass('input-validation-error');
        //$('#payDate').next('span').children().text('');
    }

    $("#identificationNumberSearch").click(function () {

        ClearLabelMessages();
        $('#noDataLabelDiv').hide();
        $('#searchGrid1').hide();
    });

    $("#div-combobox1-1").click(function () {
        ClearLabelMessages();
    });

    $("#div-combobox1-2").click(function () {
        ClearLabelMessages();
    });

    $("#div-combobox1-3").click(function () {
        ClearLabelMessages();
    });

    function ClearLabelMessages() {
        $('#noDataLabelDiv').text("");
        $('.label-success').text("");
        $('#errorStartDate').text("");
        $('#errorStartDate').text('');
        $('#startDate').removeClass('input-validation-error');
    }
                        

    function Search(para1, para2, para3, para4) {

        $.ajax({
            url: '/AdvanceUnit/SearchUnit',
            type: 'POST',
            contentType: 'application/json;',
            data: JSON.stringify({ identificationNumber: para1, year: para2, make: para3, vehicleModel: para4 }),
            success: function (View) {
                $('#searchGrid1').html(View);
                $('#searchGrid1').show();
            },
            error: function (jqXHR, textStatus, errorThrown) {
                $('#loadingSpan').hide();
                //alert("error : " + reponse);
                $('#searchGrid1').hide();

                // if session expires
                if (jqXHR.status == "404") {
                    window.location.href = '/Login/UserLogin?lbl=Session expired';
                }
            }
        });
    }
    $(document).ready(function () {

        if ($('#checkableGrid').children('tbody').children('tr').length == 0) {
            $("#checkableGridDiv").hide();
            $("#advanceAllDiv").hide();
            $("#searchDiv").hide();
            $("#searchGrid1").hide();
            //$("#unitDetailDiv").hide();
            $("#noDataLabelDiv").hide();
            $("#noUnitLabelDiv").show();
            $("#searchLabelDiv").hide();

        }
        else if (($('#checkableGrid').children('tbody').children('tr').length > 0) && ($('#searchResultGrid').children('tbody').children('tr').length > 0)) {
            $("#checkableGridDiv").show();
            $("#advanceAllDiv").show();
            $("#searchDiv").show();
            $("#searchGrid1").show();
            //$("#unitDetailDiv").show();
            $("#noDataLabelDiv").hide();
            $("#noUnitLabelDiv").hide();
            $("#searchLabelDiv").show();
        }
        else if (($('#checkableGrid').children('tbody').children('tr').length > 0) && ($('#searchResultGrid').children('tbody').children('tr').length == 0)) {
            $("#checkableGridDiv").show();
            $("#advanceAllDiv").show();
            $("#searchDiv").show();
            //$("#unitDetailDiv").show();
            $("#searchGrid1").hide();
            $("#noDataLabelDiv").show();
            $("#noUnitLabelDiv").hide();
            $("#searchLabelDiv").show();
        }

    });

</script>


<script type="text/javascript">
    var total = 0;
    var checkCount = 0;
    var totalRecCount = 0;
    var unitIdSelect = "";

    function GridUpdate() {
        var ctrl =
                $('<input />', {
                    type: 'checkbox',
                    id: "cbSelectAll",
                    click: function () {
                        var checkboxes = $(this).closest('table').find('tbody tr td input[type="checkbox"]');
                        checkboxes.prop('checked', $(this).is(':checked'));
                        var chk = checkboxes.prop('checked');
                        if (chk) {
                            var checkBoxText = $('<div />').attr({ id: 'someID' }).html('<span> Deselect </span>');
                            $('.gridtable thead tr th:first').html(checkBoxText.prepend(ctrl));
                            $("#iAdvance").attr("disabled", "disabled");


                        } else {
                            var checkBoxText = $('<div />').attr({ id: 'someID' }).html('<span> Select </span>');
                            $('.gridtable thead tr th:first').html(checkBoxText.prepend(ctrl));
                            $("#btnAdvanceAll").attr("disabled", "disabled");
                            $("#startDate").attr("disabled", "disabled");
                            $("#iAdvance").attr("disabled", "disabled");
                            //$('#iAdvance').removeClass('input-validation-error');
                            //$('#startDate').val('');
                            $('#errorStartDate').text('');
                            $('#startDate').removeClass('input-validation-error');
                            totalRecCount = 0;

                        }
                        total = 0;
                        totalRecCount = 0;
                        $('.advanceAmount').each(function () {
                            var tr = $(this).parents('tr:first');
                            totalRecCount++;
                            if (document.getElementById('all').checked) {
                                total = total + parseFloat(tr.find("#am").text().replace(',', ''));
                                checkCount++;

                                $(this).parents('tr').css('background', 'lightblue');
                            } else {
                                checkCount = 0;
                                total = 0;
                                $(this).parents('tr').css('background', 'transparent');
                            }

                            document.getElementById("subtotal").innerHTML = "Current Total to Advance : $ " + roundNumber(total,2);
                            if (checkCount > 0) {
                                $("#btnAdvanceAll").removeAttr("disabled");
                                $("#startDate").removeAttr("disabled");
                                if (totalRecCount == 1) {
                                    SetTextBoxValues(tr);
                                }
                            }

                        });
                        if (checkCount > 1) {
                            ClearTextBoxValues(); ClearSearchGrid();
                        }
                        else if (checkCount == 0 || totalRecCount == 0) {
                            $("#btnAdvanceAll").attr("disabled", "disabled");
                            $("#startDate").attr("disabled", "disabled");
                            ClearTextBoxValues();
                        }
                        $('#errorStartDate').text('');
                        $('#startDate').removeClass('input-validation-error');
                    }
                })


        var gg = $('<div />').attr({ id: 'someID' }).html('<span> Select </span>');
        $('.gridtable thead tr th:first').html(gg.prepend(ctrl));


        $('.checkboxAll').change(function () {
            var tr = $(this).parents('tr:first');
            //var fullcost = parseFloat(tr.find("#am").text().replace(',', ''));
            //var numValue = Number.parseFloat(tr.find("#am").text());
            //alert(fullcost);
            var checked = tr.find("#all").is(':checked');
            if (checked) {
                total = total + parseFloat(tr.find("#am").text().replace(',', ''));
                checkCount++;
                $(this).parents('tr').css('background', 'lightblue');
            } else {
                total = total - parseFloat(tr.find("#am").text().replace(',', ''));
                checkCount--;
                $(this).parents('tr').css('background', 'transparent');
            }

            if (checkCount == 1) {
               
                if (checked) {
                    SetTextBoxValues(tr);
                    //alert("r");
                    var x = tr.find("#all").val();
                    //$('#uId').val(x);
                    unitIdSelect = x;
                } else {
                    $('.advanceAmount').each(function () {

                        var tr = $(this).parents('tr:first');
                        var checked = tr.find("#all").is(':checked');

                        if (checked) {
                            SetTextBoxValues(tr);
                            //alert("r");
                            var x = tr.find("#all").val();
                            //$('#uId').val(x);
                            unitIdSelect = x;
                        }
                    });
                }
                document.getElementById("subtotal").innerHTML = "Current Total to Advance : $ " + roundNumber(total,2);
                $("#btnAdvanceAll").removeAttr("disabled");
                $("#startDate").removeAttr("disabled");
            }
            else if (checkCount == 0) {
                document.getElementById("subtotal").innerHTML = "Current Total to Advance : $ 0.00";
                ClearTextBoxValues();
                $("#btnAdvanceAll").attr("disabled", "disabled");
                $("#startDate").attr("disabled", "disabled");
                $("#iAdvance").attr("disabled", "disabled");
                $("#someID span").html('Select')

            }
            else {

                ClearTextBoxValues();
                document.getElementById("subtotal").innerHTML = "Current Total to Advance : $ " + roundNumber(total,2);
            }

            if (checkCount > 0) {

                ClearSearchGrid();
                var chkText = $('<div />').attr({ id: 'someID' }).html(' <span> Select </span>');
                $('.gridtable thead tr th:first').html(chkText.prepend(ctrl));
                //ChangeCheckBoxText('select ');

                var totalRows = $("#checkableGrid td :checkbox").length;
                var checked = $("#checkableGrid td :checkbox:checked").length;

                if (checked == totalRows) {
                    var chkText = $('<div />').attr({ id: 'someID' }).html('<span>  Deselect </span>');
                    $('.gridtable thead tr th:first').html(chkText.prepend(ctrl));
                }
            }
            $('#errorStartDate').text('');
            $('#startDate').removeClass('input-validation-error');

        });


        // Change the selector if needed
        var table = $('table'),
            bodyCells = table.find('tbody tr:first').children(),
            colWidth;

        // Adjust the width of thead cells when window resizes
        $(window).resize(function () {
            // Get the tbody columns width array
            colWidth = bodyCells.map(function () {
                return $(this)[0].getBoundingClientRect().width;
            }).get();

            // Set the width of thead columns
            table.find('thead tr').children().each(function (i, v) {
                $(v).outerWidth(colWidth[i]);
            });
        }).resize(); // Trigger resize handler

        $(window).bind("load", function () {

            // Get the tbody columns width array
            colWidth = bodyCells.map(function () {
                return $(this)[0].getBoundingClientRect().width;
            }).get();

            // Set the width of thead columns
            table.find('thead tr').children().each(function (i, v) {
                $(v).outerWidth(colWidth[i]);
            });
        });
    }

    $(function () {
        GridUpdate();
    });

    $(document).on('click', 'tbody', (function (e) {
        var target = $(e.target);
        if (target.parents('#checkableGrid').length) {
            var $td = $(e.target).closest("td");
            var rowIndex = $td.parent().index();
            rowIndex += 1;
            var ColIndex = $td.parent().children().index($td);
            var table = document.getElementById("checkableGrid");
            var row = $("tr:eq(" + rowIndex + ")", '#checkableGrid');
            ClearLabelMessages();

            if (ColIndex != 0) {

                var checked = row.find("#all").prop('checked');
                if (!checked) {
                    row.find("#all").prop('checked', true);
                    row.css('background', 'lightblue');

                    checkCount++;
                    total = total + parseFloat(row.find("#am").text().replace(',', ''));

                    if (checkCount == 1) {

                        ClearSearchGrid();
                        SetTextBoxValues(row);
                        //alert("r");
                        var x = row.find("#all").val();
                        //$('#uId').val(x);
                        unitIdSelect = x;
                    }
                    else {
                        ClearSearchGrid();

                        ClearTextBoxValues();
                    }
                    SetRadioBtnHeaderChecked();
                    document.getElementById("subtotal").innerHTML = "Current Total to Advance : $ " + roundNumber(total,2);

                    $("#btnAdvanceAll").removeAttr("disabled");
                    $("#startDate").removeAttr("disabled");
                }
            } else {
                SetRadioBtnHeaderChecked();
            }
            $('#errorStartDate').text('');
            $('#startDate').removeClass('input-validation-error');
        }
    }));

    $(document).ready(function () {
        $("#content tbody tr").each(function (i, row) {
            var $actualRow = $(row);
            if ($actualRow.find('input[type=checkbox]').prop('checked') == true) {
                $actualRow.css('background-color', '#EAF2D3');
            }
            else {
                $actualRow.css('background-color', '#FF9E9E');
            }
        });
    });

    $('#btnAdvance').click(function (e) {

        if ($("#tagscloud span").text() != "" || $('#errorAdvanceDate').text() != "") {
            e.preventDefault();
            return;
        }

        if (($('#advanceDate').val() == "")&&($('#iAdvance').val() == "")) {
            $('#advanceDate').addClass('input-validation-error');

            $('.centered span').text('Error');
            $('#errorAdvanceDate').text('Please select the Advance Date');
            $('#iAdvance').addClass('input-validation-error');

            $('.centered span').text('Error');
            $('#errorAdvanceAmount').text('Advance amount is required');
            e.preventDefault();
            return;
        }
        if ($('#advanceDate').val() == "") {

            // required error message
            $('#advanceDate').addClass('input-validation-error');

            $('.centered span').text('Error');
            $('#errorAdvanceDate').text('Please select the Advance Date');

            e.preventDefault();
            return;
        }
        if ($('#iAdvance').val() == "" || $('#iAdvance').val() == "0") {



            //advance amount required error message
            $('#iAdvance').addClass('input-validation-error');

            $('.centered span').text('Error');
            $('#errorAdvanceAmount').text('Advance amount is required');
            e.preventDefault();
            return;
        }

        else if ($('#iVin').val() != '') {

            var unit = {
                "UnitId": $('#unitid').text(),
                "IdentificationNumber": $('#iVin').val(),
                "AdvanceAmount": $('#iAdvance').val().replace(',', ''),
                "AdvanceDate": $('#advanceDate').val(),
                "Cost": $('#iCost').val().replace(',', ''), 
                "IdentificationNumber": $('#iVin').val().replace(',', ''),
                "Year": $('#iYear').val().replace(',', ''),
                "Make": $('#iMake').val().replace(',', ''),
                "Model": $('#iModel').val().replace(',', '')
            };

            $.ajax({
                url: '/AdvanceUnit/UpdateAdvance/',
                data: JSON.stringify(unit),
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                success: function (View) {
                    if (View != '0') {
                        $(location).attr('href', '/AdvanceUnit/Advance');
                    } else {
                        $(location).attr('href', '/AdvanceUnit/Advance');
                    }
                },

                error: function (jqXHR, textStatus, errorThrown) {
                    // Your handler here...

                    // if session expires
                    if (jqXHR.status == "404") {
                        window.location.href = '/Login/UserLogin?lbl=Session expired';
                    }
                }
            });
        }
    });

    $('#btnAdvanceAll').click(function () {

        if ($('#errorStartDate').text() != "") {
            e.preventDefault();
            return;
        }


        if ($('#startDate').val() == "") {

            // required error message
            $('#startDate').addClass('input-validation-error');

            $('.centered span').text('Error');
            $('#errorStartDate').text('Please select the Advance Date');
            e.preventDefault();
            return;
        }

        if (checkCount >= 1) {
            var data = { ItemList: [] };
            $('.advanceAmount').each(function () {
                var tr = $(this).parents('tr:first');
                var checked = tr.find("#all").is(':checked');
                if (checked) {
                    data.ItemList.push({
                        UnitId: tr.find("#all").val(),
                        IdentificationNumber: tr.find("#vin").text(),
                        AdvanceAmount: tr.find("#am").text().replace(',', ''),
                        AdvanceDate: $('#startDate').val(),
                        Cost: $('#iCost').val().replace(',', ''),
                        Year: tr.find("#year").text(),
                        Make: tr.find("#make").text(),
                        Model: tr.find("#model").text()
                    });

                }
            });

            $.ajax({
                url: '/AdvanceUnit/UpdateAdvanceAll/',
                data: JSON.stringify(data),
                type: 'POST',
                contentType: 'application/json; charset=utf-8',

                success: function (View) {

                    $(location).attr('href', '/AdvanceUnit/Advance');
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    // Your handler here...

                    // if session expires
                    if (jqXHR.status == "404") {
                        window.location.href = '/Login/UserLogin?lbl=Session expired';
                    }
                }
            });
        }

    });

    function ClearSearchGrid() {

        $("#searchResultGrid").find('.advance').each(function () {
            var tr = $(this).parents('tr:first');
            tr.css('background', 'transparent');
        });
    }

    function ClearTextBoxValues() {
        $('#ivin').val('');
        $('#iYear').val('');
        $('#iMake').val('');
        $('#iModel').val('');
        $('#iCost').val('');
        $('#iAdvance').val('');
        $("#btnAdvance").attr("disabled", "disabled");
        //$("#btnAdvanceAll").removeAttr("disabled");
        $("#advanceDate").attr("disabled", "disabled");
        //$("#startDate").removeAttr("disabled");
        $('#advanceDate').removeClass('input-validation-error');

        $('.centered span').text('');
        $('#errorAdvanceDate').text('');
        $('#iAdvance').removeClass('input-validation-error');

        $('.centered span').text('');
        $('#errorAdvanceAmount').text('');
        $("#singleUnitDiv").hide();
        $("#searchIdentificationNumber").text('');
        $('#identificationNumberSearch').removeClass('input-validation-error');
    }

    function SetTextBoxValues(tr) {
        $('#iVin').val(tr.find("#vin").text());
        $('#iYear').val(tr.find("#year").text());
        $('#iMake').val(tr.find("#make").text());
        $('#iModel').val(tr.find("#model").text());
        $('#iCost').val(tr.find("#cost").text());
        $('#iAdvance').val(tr.find("#am").text().replace(',', ''));
        document.getElementById("unitid").innerHTML = tr.find("#all").val();
        //document.getElementById("subtotal").innerHTML = "Current Total to Advance : $ ";
        @if(ViewBag.loanDetails.isEditAllowable == true)
{
<text> $('#iAdvance').removeAttr('disabled'); </text>
}
        $("#advanceDate").val('');
        $('#advanceDate').attr('placeholder', 'MM/DD/YYYY');
        //$("#btnAdvanceAll").attr("disabled", "disabled");
        $("#btnAdvance").removeAttr("disabled");
        //$("#startDate").attr("disabled", "disabled");
        $("#advanceDate").removeAttr("disabled");

        $('#advanceDate').removeClass('input-validation-error');

        $('.centered span').text('');
        $('#errorAdvanceDate').text('');
        $('#iAdvance').removeClass('input-validation-error');

        $('.centered span').text('');
        $('#errorAdvanceAmount').text('');
        $("#singleUnitDiv").show();

    }

    function SetRadioBtnHeaderChecked() {
        var totalRows = $("#checkableGrid td :checkbox").length;
        var checked = $("#checkableGrid td :checkbox:checked").length;

        if (checked == totalRows) {
            var chkText = $('<div />').attr({ id: 'someID' }).html('<span> Deselect </span>');
            $("#checkableGrid").find("input:checkbox").each(function () {
                this.checked = true;
            });
            $("#someID span").html('Deselect');
        }
        else {

            $("#cbSelectAll").removeAttr("checked");
        }

    }

    function ChangeCheckBoxText(value) {
        var chkText = $('<div />').attr({ id: 'someID' }).html(value);
        $('.gridtable thead tr th:first').html(chkText.prepend(ctrl));
    }

    var startPicker = new Pikaday({
        field: document.getElementById('startDate'),
        format: 'l'


    });

    startPicker.setMinDate(new Date("@ViewBag.loanDetails.startDate.Date"));
    startPicker.setMaxDate(new Date("@ViewBag.loanDetails.maturityDate.Date"));
    startPicker.gotoDate(new Date());
    var advDatePicker = new Pikaday({
        field: document.getElementById('advanceDate'),
        format: 'l'


    });


    advDatePicker.setMinDate(new Date("@ViewBag.loanDetails.startDate.Date"));
    advDatePicker.setMaxDate(new Date("@ViewBag.loanDetails.maturityDate.Date"));
    advDatePicker.gotoDate(new Date());





    //$('#iAdvance').keypress(function (e) {
    //    var cost = document.getElementById('iCost').value;

    //    if ((e.which >= 48 && e.which <= 57) || e.which === 46 || e.which === 8) {
    //        var val = this.value;

    //        if (e.which === 46 || e.which === 8) {


    //        } else {
    //            if (val.length + 1 > cost.length) {
    //                $("#tagscloud span").fadeIn();
    //                $(this).addClass('input-validation-error');
    //                $("#tagscloud span").text("Advance can not be higer than cost/ input two decimal point only");
    //                $("#tagscloud span").delay(1000).fadeOut();
    //                $(this).removeClass('input-validation-error');
    //                $("#tagscloud span");
    //                e.preventDefault();
    //            }

    //        }

    //    } else {
    //        $("#tagscloud span").fadeIn();
    //        $(this).addClass('input-validation-error')
    //        $("#tagscloud span").text("Advance must be a positive number");
    //        $("#tagscloud span").delay(1000).fadeOut();
    //        $(this).removeClass('input-validation-error');
    //        e.preventDefault();
    //    }
    //});

    //$('#iAdvance').blur(function () {

    //    var cost = document.getElementById('iCost').value;


    //    var val = $.trim($(this).val());

    //    if (val.indexOf(',') > -1) {
    //        val = val.replace(',', '');
    //    }

    //    var num = parseFloat(val);
    //    var num = num.toFixed(2);
    //    if (isNaN(num)) {
    //        num = '';
    //    }




    //    if (isNaN(num)) {

    //        $("#tagscloud span").fadeIn();
    //        $(this).addClass('input-validation-error');
    //        $("#tagscloud span").text("Advance must be a positive number");

    //    }
    //    else if (Number(num) > Number(cost)) {

    //        $("#tagscloud span").fadeIn();
    //        $(this).addClass('input-validation-error');
    //        $("#tagscloud span").text("Advance must be less than cost");


    //    }

    //    else if (Number(num) <= 0) {
    //        $("#tagscloud span").fadeIn();
    //        $(this).addClass('input-validation-error');
    //        $("#tagscloud span").text("Please enter an Advance Amount");

    //    } else {
    //        $("#tagscloud span").fadeOut();
    //        $(this).removeClass('input-validation-error');
    //        $("#tagscloud span").text("");

    //    }


    //    $(this).val(num);
    //});

    var maxAdvance = parseFloat($('#blc').text().replace(',', ''))
    $('#iAdvance').keypress(function (e) {
        var cost = document.getElementById('iCost').value.replace(',', '');

        var advance = document.getElementById('iAdvance').value.replace(',', '');
        if ((e.which >= 48 && e.which <= 57) || e.which === 46 || e.which === 8) {
            //var val = this.value + (e.which - 48);
            //alert(cost + ' ' + val);
            if (e.which !== 46 && e.which !== 8) {
                if (cost === 0.00 || Number(advance) > Number(cost) ) {
                    //$("#tagscloudAdvance span").fadeIn();
                    $(this).addClass('input-validation-error');
                    $("#tagscloud span").text("Advance must be less than cost");
                    //$("#tagscloudAdvance span").delay(1000).fadeOut();
                    //$(this).removeClass('input-validation-error');
                    e.preventDefault();
                }
                if (advance > maxAdvance) {
                    //$("#tagscloudAdvance span").fadeIn();
                    $(this).addClass('input-validation-error');
                    $("#tagscloud span").text("Advance must be less than balance");
                    //$("#tagscloudAdvance span").delay(1000).fadeOut();
                    //$(this).removeClass('input-validation-error');
                    e.preventDefault();
                }
                //if (Number(advance) === 0.00) {
                //    //$("#tagscloudAdvance span").fadeIn();
                //    $(this).addClass('input-validation-error');
                //    $("#tagscloud span").text("Advance can't be zero");
                //    //$("#tagscloudAdvance span").delay(1000).fadeOut();
                //    //$(this).removeClass('input-validation-error');
                //    e.preventDefault();
                //}
            }
        } else {
            //$("#tagscloudAdvance span").fadeIn();
            $(this).addClass('input-validation-error');
            $("#tagscloudAdvance span").text("Invalid character");
            //$("#tagscloudAdvance span").delay(1000).fadeOut();
            $(this).removeClass('input-validation-error');
            e.preventDefault();
        }
    });

    //claculate advance when click back-space
    $('#iAdvance').keyup(function (e) {
        //alert(e.keyCode);
        if (e.keyCode === 8) {
            var val = this.value;
            //document.getElementById('txtAdvanceAmount').value = val;
            $("#tagscloud span").text("");
        }
    });

    $('#iAdvance').blur(function () {
        var cost = document.getElementById('iCost').value.replace(',', '');
        var advance = document.getElementById('iAdvance').value.replace(',', '');
        var val = $.trim($(this).val());

        if (val.indexOf(',') > -1) {
            val = val.replace(',', '');
        }

        var num = parseFloat(val);
        num = num.toFixed(2);
        if (isNaN(num)) {
            num = '';
        }

        if (isNaN(num)) {

            //$("#tagscloudAdvance span").fadeIn();
            $(this).addClass('input-validation-error');
            $("#tagscloud span").text("Advance must be a positive number");

        }
        else if (Number(num) === 0) {
            $(this).addClass('input-validation-error');
            $('.centered span').text('Error');
            $("#tagscloud span").text("Please enter an Advance Amount");
        }
        else if (Number(num) > Number(cost)) {
            //$("#tagscloudAdvance span").fadeIn();
            $(this).addClass('input-validation-error');
            $("#tagscloud span").text("Advance  must be less than cost");
        }
        else if (Number(num) == "") {
            //$("#tagscloudAdvance span").fadeIn();
            //$(this).addClass('input-validation-error');
            $("#tagscloud span").text("");
        }
        else if (Number(num) <= 0) {
            //$("#tagscloudAdvance span").fadeIn();
            $(this).addClass('input-validation-error');
            $("#tagscloud span").text("Please enter an Advance Amount");
        }
        else if (advance > maxAdvance) {
            //$("#tagscloudAdvance span").fadeIn();
            $(this).addClass('input-validation-error');
            $("#tagscloud span").text("Advance must be less than balance");
            //$("#tagscloudAdvance span").delay(1000).fadeOut();
            //$(this).removeClass('input-validation-error');
            e.preventDefault();
        }
        else {
            //$("#tagscloudAdvance span").fadeOut();
            $(this).removeClass('input-validation-error');
            $("#tagscloud span").text("");
            $('.centered span').text('');
        }

        $(this).val(num);
    });


    //$('.ui-button').click(function () {
    //    $('.centered1 span').text('');
    //});


    $('#identificationNumberSearch').focusout(function () {
        $(this).attr('placeholder', 'Last 6 of VIN/HIN/SN');
    });

    function roundNumber(number, decimal_points) {
        if (!decimal_points) return Math.round(number);
        if (number == 0) {
            var decimals = "";
            for (var i = 0; i < decimal_points; i++) decimals += "0";
            return "0." + decimals;
        }

        var exponent = Math.pow(10, decimal_points);
        var num = Math.round((number * exponent)).toString();
        return num.slice(0, -1 * decimal_points) + "." + num.slice(-1 * decimal_points)
    }




    $('#advanceDate').val('');
    $('#startDate').val('');

    $('#advanceDate').click(function () {

        $('#errorAdvanceDate').text('');
        $(this).removeClass('input-validation-error');

    });
    $('#advanceDate').blur(function () {

        if ($(this).val() == "") {
            $('#errorAdvanceDate').text('Please select the Advance Date');
            $(this).addClass('input-validation-error');
            $(this).attr('placeholder', 'MM/DD/YYYY');
            $('.centered span').text('Error');
            return;
        }
        var valid = isValidDate($(this).val());
        if (valid) {
            var selectedDate = new Date($(this).val());
            var minDate = new Date("@ViewBag.loanDetails.startDate.Date");
            var maxDate = new Date("@ViewBag.loanDetails.maturityDate.Date");
            if (selectedDate < minDate || selectedDate > maxDate) {
                // out off range error
                $('#errorAdvanceDate').text('Out of Range');
                $(this).addClass('input-validation-error');
                $('.centered span').text('Error');
            } else {
                // delete error mssage
                $('#errorAdvanceDate').text('');
                $(this).removeClass('input-validation-error');
            }



        } else {

            // not valid data error
            $('#errorAdvanceDate').text('Not valid date');
            $(this).addClass('input-validation-error');
            $('.centered span').text('Error');
        }
    });

    $('#startDate').click(function () {

        $('#errorStartDate').text('');
        $(this).removeClass('input-validation-error');

    });
    $('#startDate').blur(function () {

        if ($(this).val() == "") {

            $('#errorStartDate').text('Please select the Advance Date');
            $(this).addClass('input-validation-error');
            $(this).attr('placeholder', 'MM/DD/YYYY');
            $('.centered span').text('Error');

            return;
        }
        var valid = isValidDate($(this).val());
        if (valid) {
            var selectedDate = new Date($(this).val());
            var minDate = new Date("@ViewBag.loanDetails.startDate.Date");
            var maxDate = new Date("@ViewBag.loanDetails.maturityDate.Date");
            if (selectedDate < minDate || selectedDate > maxDate) {
                // out off range error
                $('#errorStartDate').text('Out of Range');
                $(this).addClass('input-validation-error');
                $('.centered span').text('Error');
            } else {
                // delete error mssage
                $('#errorStartDate').text('');
                $(this).removeClass('input-validation-error');
            }



        } else {

            // not valid data error
            $('#errorStartDate').text('Not valid date');
            $(this).addClass('input-validation-error');
            $('.centered span').text('Error');
        }
    });

    //$('.titleView').click(function () {
    //    showPopup(9);

    //});
    $('#titleShow').click(function () {
        alert("hjhjhjh");
        //var uId = $('#uId').val();
        var uId = unitIdSelect;
        //alert(uId);
        $.ajax({
            url: '/AdvanceUnit/loadTitles',
            type: 'POST',
            contentType: 'application/json;',
            data: JSON.stringify({ unitId : uId }),
            success: function (data) {
                //alert("k");
                $('#titles').html(data);
                $('#titles').show();
                showPopup(9);
            },
            error: function (jqXHR, textStatus, errorThrown) {
                // Your handler here...

                // if session expires
                if (jqXHR.status == "404") {
                    window.location.href = '/Login/UserLogin?lbl=Session expired';
                }
            }
        });

    });

</script>


<div id="titles"></div>


