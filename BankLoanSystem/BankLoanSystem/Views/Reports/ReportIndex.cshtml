@model BankLoanSystem.Models.LoanIdNumberViewModel

@{
    Layout = "~/Views/Shared/_DashBoardLayout.cshtml";
    ViewBag.Title = "Reports";
    ViewBag.Page = 7;
}

@using BankLoanSystem.Models

<script src="~/scripts/moment.js"></script>
<script src="~/scripts/pikaday.js"></script>
<script src="~/scripts/jquery-1.10.2.min.js"></script>
<script src="~/scripts/bootstrap.min.js"></script>
<script src="~/scripts/bootstrap.min.js"></script>


<!-- This is for jqGrid-->
<link href="~/Content/themes/base/jquery-ui.css?version=1" rel="stylesheet" type="text/css" />
<link href="~/Content/jquery.jqGrid/ui.jqgrid.css" rel="stylesheet" type="text/css" />
<script src="~/Scripts/jquery-ui-1.10.0.min.js"></script>
<script src="~/Scripts/i18n/grid.locale-en.js" type="text/javascript"></script>
<script src="~/Scripts/jquery.jqGrid.min.js" type="text/javascript"></script>

@section AddToHead{
    <style>
        .btns-clm > button {
            width: 225px;
            height: 40px;
            margin-bottom: 10px;
            margin-left: 5px;
            margin-right: 5px;
            font-size: 13px;
        }

        .btn-info1 {
            color: black;
            background-color: #d9d9d9;
            border-color: #8e8a8a;
        }

            .btn-info1:hover {
                color: black;
                background-color: #7f7676;
                border-color: #8e8a8a;
            }

        .icon-help_outline {
            color: #1263dc;
        }
         .icon-help_outline hd {
            color: #BDBBBB;
        }
    </style>

    @if ((ViewBag.RoleId == 3 || ViewBag.RoleId == 4) && ViewBag.loanCount > 1)
    {
        <style>
            .btn.btn-info1 {
                display: none;
            }
        </style>

    }

}


<div class="overlay-content popup-changed-loan">

    <h3>Message</h3>

    <div class="alert alert-info" role="alert" id="loanChangedtext">
        You have changed the loan to ....... Do you like to continue work with this Loan?
    </div><br />
    <span id="loanChangedspan"> Press Yes to work with loan CCCC or press No to work with loan XXXX. </span><br />
    <br />

    <button class="close-btn btn btn-info" id="chanegLoan" style="width: 70px;margin-right: 20px;">YES</button>
    <button class="close-btn btn btn-info" style="width: 70px;" onclick="window.location.href = '/UserManagement/UserDetails';">NO</button>

</div>



@{Html.RenderAction("LoanInfo", "Unit", new { title = @ViewBag.Title, msg = @ViewBag.Msg });
}



@if (ViewBag.loanCount == 1)
{

}
else if (ViewBag.loanCount > 1)
{

    <div style="padding-left:12px;padding-right:12px;padding-bottom: 10px;text-align:left">
        <label><strong> Select a loan then choose a report to display </strong></label>
        <table id="grid"></table>
        <div id="pager2"></div>
    </div>
}



<div class="container" id="container" style="padding-top:20px !important">
    <div id="errPage" class="field-validation-error"><span class="text-danger"></span></div>
    <div class="btns-clm" id="divRptType">
        <input type="hidden" name="selectedButton" id="hdnSelectedButton" value="" />
        @*if the user admin or super admin*@

        @if (ViewBag.RoleId == 1 || ViewBag.RoleId == 2)
        {
            @*//Ordering the buttons according to the list*@
        foreach (Right report in (List<Right>)ViewBag.getReportRights)
        {
            if (report.rightId == "R01")
            {
                <button type="button" id="btnLotInspection" class="btn btn-info1">Lot Inspection <span class="icon-help_outline help-lot-insp"></span></button>
            }

            else if (report.rightId == "R02")
            {
                <button type="button" id="btnCurtailmentInvoice" class="btn btn-info1">Curtailment Invoice <span class="icon-help_outline help-curt-inv"></span></button>
            }

            else if (report.rightId == "R03")
            {
                <button type="button" id="btnCurtailmentReceipt" class="btn btn-info1">Curtailment Receipt <span class="icon-help_outline help-curt-rcpt"></span></button>
            }

            else if (report.rightId == "R04")
            {
                <button type="button" id="btnTitlesStatus" class="btn btn-info1">Title Status <span class="icon-help_outline help-titl-stat"></span></button>
            }

            else if (report.rightId == "R05")
            {
                <button type="button" id="btnFullInventory" class="btn btn-info1">Full Active Inventory <span class="icon-help_outline help-full-inv"></span></button>
            }

            else if (report.rightId == "R06")
            {
                <button type="button" id="btnAdvanceUnit" class="btn btn-info1">Advance Unit <span class="icon-help_outline help-adv-unit"></span></button>
            }

            else if (report.rightId == "R07")
            {
                <button type="button" id="btnAdvFeeInv" class="btn btn-info1">Advance Fee Invoice <span class="icon-help_outline help-adv-fee"></span></button>
            }

            else if (report.rightId == "R08")
            {
                <button type="button" id="btnAdvanceFeeReceipt" class="btn btn-info1">Advance Fee Receipt <span class="icon-help_outline help-adv-fee-rcpt"></span></button>
            }

            else if (report.rightId == "R09")
            {
                <button type="button" id="btnLoanFeeInv" class="btn btn-info1">Monthly Loan Fee Invoice <span class="icon-help_outline help-mon-fee"></span></button>
            }

            else if (report.rightId == "R10")
            {
                <button type="button" id="btnMonthlyLoanFeeReceipt" class="btn btn-info1">Monthly Loan Fee Receipt <span class="icon-help_outline help-mon-fee-rcpt"></span></button>
            }

            else if (report.rightId == "R11")
            {
                <button type="button" id="btnLotInsFeeInv" class="btn btn-info1">Lot Inspection Fee Invoice <span class="icon-help_outline help-lot-fee"></span></button>
            }

            else if (report.rightId == "R12")
            {
                <button type="button" id="btnLotInspectionFeeReceipt" class="btn btn-info1">Lot Inspection Fee Receipt <span class="icon-help_outline help-lot-fee-rcpt"></span></button>
            }

            else if (report.rightId == "R13")
            {
                <button type="button" id="btnPayOff" class="btn btn-info1">Pay Off <span class="icon-help_outline help-pay-off"></span></button>
            }

            else if (report.rightId == "R14")
            {
                <button type="button" id="btnTransactionHistory" class="btn btn-info1">Transaction History <span class="icon-help_outline help-trans-his"></span></button>
            }

            else if (report.rightId == "R15")
            {
                <button type="button" id="btnLoanTerms" class="btn btn-info1">Loan Terms <span class="icon-help_outline help-loan-terms"></span></button>
            }

            else if (report.rightId == "R16")
            {
                <button type="button" id="btnDeletedUnits" class="btn btn-info1">Deleted Units <span class="icon-help_outline help-del-unit"></span></button>
            }

            else if (report.rightId == "R19")
            {
                <button type="button" id="btnLoanSummary" class="btn btn-info1">Loan Summary <span class="icon-help_outline help-loan-smry"></span></button>
            }

            else if (report.rightId == "R20")
            {
                <button type="button" id="btnBranchSummary" class="btn btn-info1">Branch Summary <span class="icon-help_outline help-brn-smry"></span></button>
            }

            else if (report.rightId == "R21" && ViewBag.RoleId == 1)
            {
                <button type="button" id="btnCompanySummary" class="btn btn-info1">Company Summary <span class="icon-help_outline help-cmp-smry"></span></button>
            }
            else if (report.rightId == "R17")
            {
                <button type="button" id="btnIndCurtSummary" class="btn btn-info1">Individual Curtailment Summary<span class="icon-help_outline help-ind-curt-smry"></span></button>
            }
            else if (report.rightId == "R18")
            {
                <button type="button" id="btnFullCurtSummary" class="btn btn-info1">Full Curtailment Summary<span class="icon-help_outline help-full-curt-smry"></span></button>
                }


            }
        }
        // if user is normal user or dealer and if he has only one loan
        else if ((ViewBag.RoleId == 3 || ViewBag.RoleId == 4) && ViewBag.loan != null)
        {
            string reportRights = ((List<Account>)ViewBag.loan)[0].userReportRights;
            foreach (Right report in (List<Right>)ViewBag.getReportRights)
            {
                if (report.rightId == "R01" && reportRights.Contains("R01"))
                {
                    <button type="button" id="btnLotInspection" class="btn btn-info1">Lot Inspection <span class="icon-help_outline help-lot-insp"></span></button>
                }

                else if (report.rightId == "R02" && reportRights.Contains("R02"))
                {
                    <button type="button" id="btnCurtailmentInvoice" class="btn btn-info1">Curtailment Invoice <span class="icon-help_outline help-curt-inv"></span></button>
                }

                else if (report.rightId == "R03" && reportRights.Contains("R03"))
                {
                    <button type="button" id="btnCurtailmentReceipt" class="btn btn-info1">Curtailment Receipt <span class="icon-help_outline help-curt-rcpt"></span></button>
                }

                else if (report.rightId == "R04" && reportRights.Contains("R04"))
                {
                    <button type="button" id="btnTitlesStatus" class="btn btn-info1">Title Status <span class="icon-help_outline help-titl-stat"></span></button>
                }

                else if (report.rightId == "R05" && reportRights.Contains("R05"))
                {
                    <button type="button" id="btnFullInventory" class="btn btn-info1">Full Active Inventory <span class="icon-help_outline help-full-inv"></span></button>
                }

                else if (report.rightId == "R06" && reportRights.Contains("R06"))
                {
                    <button type="button" id="btnAdvanceUnit" class="btn btn-info1">Advance Unit <span class="icon-help_outline help-adv-unit"></span></button>
                }

                else if (report.rightId == "R07" && reportRights.Contains("R07"))
                {
                    <button type="button" id="btnAdvFeeInv" class="btn btn-info1">Advance Fee Invoice <span class="icon-help_outline help-adv-fee"></span></button>
                }

                else if (report.rightId == "R08" && reportRights.Contains("R08"))
                {
                    <button type="button" id="btnAdvanceFeeReceipt" class="btn btn-info1">Advance Fee Receipt <span class="icon-help_outline help-adv-fee-rcpt"></span></button>
                }

                else if (report.rightId == "R09" && reportRights.Contains("R09"))
                {
                    <button type="button" id="btnLoanFeeInv" class="btn btn-info1">Monthly Loan Fee Invoice <span class="icon-help_outline help-mon-fee"></span></button>
                }

                else if (report.rightId == "R10" && reportRights.Contains("R10"))
                {
                    <button type="button" id="btnMonthlyLoanFeeReceipt" class="btn btn-info1">Monthly Loan Fee Receipt <span class="icon-help_outline help-mon-fee-rcpt"></span></button>
                }

                else if (report.rightId == "R11" && reportRights.Contains("R11"))
                {
                    <button type="button" id="btnLotInsFeeInv" class="btn btn-info1">Lot Inspection Fee Invoice <span class="icon-help_outline help-lot-fee"></span></button>
                }

                else if (report.rightId == "R12" && reportRights.Contains("R12"))
                {
                    <button type="button" id="btnLotInspectionFeeReceipt" class="btn btn-info1">Lot Inspection Fee Receipt <span class="icon-help_outline help-lot-fee-rcpt"></span></button>
                }

                else if (report.rightId == "R13" && reportRights.Contains("R13"))
                {
                    <button type="button" id="btnPayOff" class="btn btn-info1">Pay Off <span class="icon-help_outline help-pay-off"></span></button>
                }

                else if (report.rightId == "R14" && reportRights.Contains("R14"))
                {
                    <button type="button" id="btnTransactionHistory" class="btn btn-info1">Transaction History <span class="icon-help_outline help-trans-his"></span></button>
                }

                else if (report.rightId == "R15" && reportRights.Contains("R15"))
                {
                    <button type="button" id="btnLoanTerms" class="btn btn-info1">Loan Terms <span class="icon-help_outline help-loan-terms"></span></button>
                }

                else if (report.rightId == "R16" && reportRights.Contains("R16"))
                {
                    <button type="button" id="btnDeletedUnits" class="btn btn-info1">Deleted Units <span class="icon-help_outline help-del-unit"></span></button>
                }

                else if (report.rightId == "R19" && reportRights.Contains("R19"))
                {
                    <button type="button" id="btnLoanSummary" class="btn btn-info1">Loan Summary <span class="icon-help_outline help-loan-smry"></span></button>
                }
                else if (report.rightId == "R17")
                {
                    <button type="button" id="btnIndCurtSummary" class="btn btn-info1">Individual Curtailment Summary<span class="icon-help_outline help-ind-curt-smry"></span></button>
                }
                else if (report.rightId == "R18" && reportRights.Contains("R18"))
                {
                    <button type="button" id="btnFullCurtSummary" class="btn btn-info1">Full Curtailment Summary<span class="icon-help_outline help-full-curt-smry"></span></button>
                }


            }

        }
        // if user is normal user or dealer and if he has multiple loan
        else if ((ViewBag.RoleId == 3 || ViewBag.RoleId == 4) && ViewBag.loanCount > 1)
        {


            @*//Ordering the buttons according to the list*@
        foreach (Right report in (List<Right>)ViewBag.getReportRights)
        {
            if (report.rightId == "R01")
            {
                <button type="button" id="btnLotInspection" class="btn btn-info1">Lot Inspection <span class="icon-help_outline help-lot-insp"></span></button>
            }

            else if (report.rightId == "R02")
            {
                <button type="button" id="btnCurtailmentInvoice" class="btn btn-info1">Curtailment Invoice <span class="icon-help_outline help-curt-inv"></span></button>
            }

            else if (report.rightId == "R03")
            {
                <button type="button" id="btnCurtailmentReceipt" class="btn btn-info1">Curtailment Receipt <span class="icon-help_outline help-curt-rcpt"></span></button>
            }

            else if (report.rightId == "R04")
            {
                <button type="button" id="btnTitlesStatus" class="btn btn-info1">Title Status <span class="icon-help_outline help-titl-stat"></span></button>
            }

            else if (report.rightId == "R05")
            {
                <button type="button" id="btnFullInventory" class="btn btn-info1">Full Active Inventory <span class="icon-help_outline help-full-inv"></span></button>
            }

            else if (report.rightId == "R06")
            {
                <button type="button" id="btnAdvanceUnit" class="btn btn-info1">Advance Unit <span class="icon-help_outline help-adv-unit"></span></button>
            }

            else if (report.rightId == "R07")
            {
                <button type="button" id="btnAdvFeeInv" class="btn btn-info1">Advance Fee Invoice <span class="icon-help_outline help-adv-fee"></span></button>
            }

            else if (report.rightId == "R08")
            {
                <button type="button" id="btnAdvanceFeeReceipt" class="btn btn-info1">Advance Fee Receipt <span class="icon-help_outline help-adv-fee-rcpt"></span></button>
            }

            else if (report.rightId == "R09")
            {
                <button type="button" id="btnLoanFeeInv" class="btn btn-info1">Monthly Loan Fee Invoice <span class="icon-help_outline help-mon-fee"></span></button>
            }

            else if (report.rightId == "R10")
            {
                <button type="button" id="btnMonthlyLoanFeeReceipt" class="btn btn-info1">Monthly Loan Fee Receipt <span class="icon-help_outline help-mon-fee-rcpt"></span></button>
            }

            else if (report.rightId == "R11")
            {
                <button type="button" id="btnLotInsFeeInv" class="btn btn-info1">Lot Inspection Fee Invoice <span class="icon-help_outline help-lot-fee"></span></button>
            }

            else if (report.rightId == "R12")
            {
                <button type="button" id="btnLotInspectionFeeReceipt" class="btn btn-info1">Lot Inspection Fee Receipt <span class="icon-help_outline help-lot-fee-rcpt"></span></button>
            }

            else if (report.rightId == "R13")
            {
                <button type="button" id="btnPayOff" class="btn btn-info1">Pay Off <span class="icon-help_outline help-pay-off"></span></button>
            }

            else if (report.rightId == "R14")
            {
                <button type="button" id="btnTransactionHistory" class="btn btn-info1">Transaction History <span class="icon-help_outline help-trans-his"></span></button>
            }

            else if (report.rightId == "R15")
            {
                <button type="button" id="btnLoanTerms" class="btn btn-info1">Loan Terms <span class="icon-help_outline help-loan-terms"></span></button>
            }

            else if (report.rightId == "R16")
            {
                <button type="button" id="btnDeletedUnits" class="btn btn-info1">Deleted Units <span class="icon-help_outline help-del-unit"></span></button>
            }

            else if (report.rightId == "R19")
            {
                <button type="button" id="btnLoanSummary" class="btn btn-info1">Loan Summary <span class="icon-help_outline help-loan-smry"></span></button>
            }
            else if (report.rightId == "R17")
            {
                <button type="button" id="btnIndCurtSummary" class="btn btn-info1">Individual Curtailment Summary<span class="icon-help_outline help-ind-curt-smry"></span></button>
            }
            else if (report.rightId == "R18")
            {
                <button type="button" id="btnFullCurtSummary" class="btn btn-info1">Full Curtailment Summary<span class="icon-help_outline help-full-curt-smry"></span></button>
                }

            }



        }



    </div>

    <hr />

    <!---->
    <div style="margin-top:15px;" id="liFilteringSection">
        <div class="form-inline" style="text-align:left;width:70%;display: inline-block;
    float: left;padding-left: 10px;">
            <div id="lnum" class="form-group" style="width:50%;">
                @*if total number of loan equal to one *@
                @if (ViewBag.loanCount == 1)
                {


                    @* if there is one loan and its paased from dashboard*@
                if (Session["LoanOne"] != null)
                {

                    <input type="hidden" id="loanId" value="@(((Loan)Session["LoanOne"]).LoanId)" />
                }
                // for user or dealer user.. if he has only one authorized loan
                else if (ViewBag.loan != null)
                {
                    List<Account> acc = (List<Account>)ViewBag.loan;

                    string PatBranchAddress = acc[0].PatBranchAddress1 + (acc[0].PatBranchAddress2 != "" ? ", " + acc[0].PatBranchAddress2 : "") + (acc[0].PatCity != "" ? ", " + acc[0].PatCity : ""); // combine address using name, address1, address2 and city

                    <input type="hidden" id="loanId" value="@(acc[0].LoanId)" />
                        <script>
                            $(document).ready(function () {
                                // set the address on the bar
                                $('#Pataddress').html('<span class="parbranchname">@(acc[0].PatBranchName)</span> -  <span class="parbarnchaddress"> @PatBranchAddress</span>  ');
                                // set the loan number on the bar
                                $('.loanumber').html('<strong>Loan Number : &nbsp; </strong> @(acc[0].LoanNumber)');

                            });
                        </script>
                    }
                }
                else
                {
                    <input type="hidden" id="loanId" value="" />

                }

                @if (ViewBag.RoleId == 1)
                {
                    <div id="divBranch" class="form-group row" style="float:left; display: none; width:117%;margin-top:15px !important">
                        <label for="" class="col-sm-6 form-control-label" style="width:83%">Select the branch of your company which you would like to view the summary of.<span class="icon-help_outline help-branch"></span></label>
                        <div class="col-md-2">
                            @Html.DropDownList("Branch", new SelectList(ViewBag.BranchSelectList, "Value", "Text"), "-- select branch --", new { @class = "form-control", @style = "width: 253px;", @id = "branchSelect" })
                            <div id="tagscloudBranch" class="field-validation-error" style="width:405%"><span class="text-danger"></span></div>
                        </div>
                    </div>
                }
                @*else {
                            <div id="divBranch" class="form-group hf" style="margin-left: 20px; display: none; width: 25%">
                                <label for="">Branch<span class="icon-help_outline help-branch"></span></label>

                                @Html.Label("Branch", (string)ViewBag.BranchName, new { @class = "form-control", @style = "width: 253px;min-width: 256px;", @id = "branchSelect" })
                                <div id="tagscloudBranch" class="field-validation-error"><span class="text-danger"></span></div>
                    </div>
                        }*@

            </div>


            <div id="strdate" class="form-group hf" style="margin-left:20px;display:none;width:20%">
                <label for="">Start Date <span class="icon-help_outline help-start-date"></span></label>
                @Html.EditorFor(model => model.StartDate, new { htmlAttributes = new { @class = "form-control dateKeyPressValidate", @id = "startDate", Value = "", @placeholder = "MM/DD/YYYY", autocomplete = "off", style = "width:100%" } })
                @Html.ValidationMessageFor(model => model.StartDate, "", new { @class = "text-danger", style = "left:25%" })
                <div id="tagscloudStartDate" class="field-validation-error"><span class="text-danger"></span></div>
            </div>

            <div id="enddate" class="form-group hf" style="margin-left: 20px; display: none; width: 20%">
                <label for="">End Date</label>
                @Html.EditorFor(model => model.EndDate, new { htmlAttributes = new { @class = "form-control dateKeyPressValidate", @id = "endDate", Value = "", @placeholder = "MM/DD/YYYY", autocomplete = "off", style = "width:100%" } })
                @Html.ValidationMessageFor(model => model.EndDate, "", new { @class = "text-danger", style = "left:25%" })
                <div id="tagscloudEndDate" class="field-validation-error"><span class="text-danger"></span></div>
            </div>

            <div id="ttlsts" class="form-group hf" style="margin-left: 20px; display: none; width: 20%">
                <label for="">Title Status <span class="icon-help_outline help-titl-slct"></span></label>
                @{
                    List<SelectListItem> titleStatus = new List<SelectListItem>();

                    titleStatus.Add(new SelectListItem
                    {
                        Text = "Not Received",
                        Value = "0"
                    });
                    titleStatus.Add(new SelectListItem
                    {
                        Text = "Received",
                        Value = "1"
                    });
                    titleStatus.Add(new SelectListItem
                    {
                        Text = "Returned to Dealer",
                        Value = "2"
                    });
                    titleStatus.Add(new SelectListItem
                    {
                        Text = "All",
                        Value = "3"
                    });
                }
                @Html.DropDownList("Title Status", titleStatus, "-- select type --", new { @class = "form-control", @id = "titleStatus" })
                <div id="tagscloudTitleStatus" class="field-validation-error"><span class="text-danger"></span></div>
            </div>
            @*for individual curtailment summary report*@
            <div id="idNumberDiv" class="form-group row" style="float:left; display: none; width:117%">
                <label for="" class="col-sm-6 form-control-label">Type in the last 6 characters of the VIN/HIN/Serial Number for the unit you would like to view the curtailment summary of. <span class="icon-help_outline help-idnumber"></span></label>
                <div class="col-md-2">
                    @Html.EditorFor(model => model.IDNumber, new { htmlAttributes = new { @class = "form-control", @id = "idNumber", @placeholder = "Last 6 characters of VIN/HIN/SN", autocomplete = "off", style = "width:230%", @maxlength = 6 } })
                    @Html.ValidationMessageFor(model => model.IDNumber, "", new { @class = "text-danger", style = "left:25%" })
                    <div id="tagscloudIDNumber" class="field-validation-error" style="width:170%"><span class="text-danger"></span></div>
                </div>
            </div>

        </div>

        <div class="form-inline" style="width: 30%;float: left;padding-top: 5px;">
            <div class="form-group" style="float:left;">
                <input style="font-size:14px; width: 100px;float:left;" type="button" id="btnDisplay" value="Display" class="btn btn-primary m-b cancel next_clear_button back_back" />
                <input style="font-size:14px;width: 100px;float:left;display:none;" type="button" value="Print" id="btnPrint" class="btn btn-primary m-b cancel next_clear_button back_back" />

            </div>
        </div>

    </div>
    <!---->


    <hr />

    <div><span id="errorMsg" style="float: right;margin-right: 179px;color: red;"></span></div>
    <div id="reportViewerDiv" hidden>
        <iframe id="ifrmReportViewer" style="height: 700px; width: 100%;" frameborder="0" scrolling="no"></iframe>
    </div>


</div>

<div class="link-bar" style="margin-bottom:15px;">


    <button class="a_demo_three icon-home3" onclick="window.location.href = '/UserManagement/UserDetails'">

        DashBoard
    </button>
</div>



<script type="text/javascript">

    function ParentPrintHide() {
        $('#btnPrint').hide();
        $('#errorMsg').text('There is no data to display for the report. Please change your criteria and try again.');
        $('#reportViewerDiv').hide();
    }

    function ParentPrintShow() {
        $('#errorMsg').text('');
        $('#btnPrint').show();
        $('#reportViewerDiv').show();
    }

    $('#idNumber').focusout(function () {
        $(this).attr('placeholder', 'Last 6 characters of VIN/HIN/SN');
    });
    $('#branchSelect').change(function () {
        $('#tagscloudBranch').children('span').text("");
        $("#branchSelect").removeClass('input-validation-error');
    });
    var errorCount = 0;

    function ChangeButtonColor(id) {
        $('.centered h5 span').text("");
        $(id).css({ 'background': 'green' });
        $('#divRptType').children('button').not(id).css({ 'background': '#d9d9d9' });
        $('#reportViewerDiv').hide();
        $('#btnPrint').hide();
        $('#LoanId').removeClass('input-validation-error');
        $('#errorMsg').text('');
    }

    $('#btnLotInspection').click(function () {
        ChangeButtonColor(this);
        $('#hdnSelectedButton').val('LotInspection');
        $('#tagscloudBranch').children('span').text("");
        $("#branchSelect").removeClass('input-validation-error');
        $('#divBranch').hide();
        // $('#lnum').show();
        // $('#lnum').siblings('.hf').hide();
        // $('#lnum').siblings('.hf').children('input').val('');

        $('#titleStatus').find('option:first').prop('selected', 'selected');
        $('#tagscloudTitleStatus').children('span').text('');
        $('#titleStatus').removeClass('input-validation-error');
        $('#ttlsts').hide();

        $('#tagscloudStartDate').children('span').text('');
        $('#startDate').removeClass('input-validation-error');
        $('#strdate').hide();
        $('#tagscloudEndDate').children('span').text('');
        $('#endDate').removeClass('input-validation-error');
        $('#enddate').hide();

        $('#idNumber').val("");
        $('#tagscloudIDNumber').children('span').text('');
        $('#idNumber').removeClass('input-validation-error');
        $('#idNumberDiv').hide();
    });

    $('#btnCurtailmentInvoice').click(function () {
        ChangeButtonColor(this);
        $('#hdnSelectedButton').val('CurtailmentInvoice');
        $('#tagscloudBranch').children('span').text("");
        $("#branchSelect").removeClass('input-validation-error');
        $('#divBranch').hide();
        //  $('#lnum').show();
        $('#ttlsts').hide().siblings('.hf').show();
        $('#ttlsts').siblings('.hf').children('input').val('');
        $('#ttlsts').siblings('.hf').children('input').attr('placeholder', 'MM/DD/YYYY');
        $('#ttlsts').siblings('.hf').children('input').siblings('div').children('span').text('');
        $('#ttlsts').siblings('.hf').children('input').removeClass('input-validation-error');

        $('#titleStatus').find('option:first').prop('selected', 'selected');
        $('#tagscloudTitleStatus').children('span').text('');
        $('#titleStatus').removeClass('input-validation-error');

        $('#idNumber').val("");
        $('#tagscloudIDNumber').children('span').text('');
        $('#idNumber').removeClass('input-validation-error');
        $('#idNumberDiv').hide();
    });

    $('#btnCurtailmentReceipt').click(function () {
        ChangeButtonColor(this);
        $('#hdnSelectedButton').val('CurtailmentReceipt');
        $('#tagscloudBranch').children('span').text("");
        $("#branchSelect").removeClass('input-validation-error');
        $('#divBranch').hide();
        //   $('#lnum').show();
        $('#ttlsts').hide().siblings('.hf').show();
        $('#ttlsts').siblings('.hf').children('input').val('');
        $('#ttlsts').siblings('.hf').children('input').attr('placeholder', 'MM/DD/YYYY');
        $('#ttlsts').siblings('.hf').children('input').siblings('div').children('span').text('');
        $('#ttlsts').siblings('.hf').children('input').removeClass('input-validation-error');

        $('#titleStatus').find('option:first').prop('selected', 'selected');
        $('#tagscloudTitleStatus').children('span').text('');
        $('#titleStatus').removeClass('input-validation-error');

        $('#idNumber').val("");
        $('#tagscloudIDNumber').children('span').text('');
        $('#idNumber').removeClass('input-validation-error');
        $('#idNumberDiv').hide();
    });
    $('#btnAdvanceFeeReceipt').click(function () {
        ChangeButtonColor(this);
        $('#hdnSelectedButton').val('AdvanceFeeReceipt');
        $('#tagscloudBranch').children('span').text("");
        $("#branchSelect").removeClass('input-validation-error');
        $('#divBranch').hide();
        //  $('#lnum').show();
        $('#ttlsts').hide().siblings('.hf').show();
        $('#ttlsts').siblings('.hf').children('input').val('');
        $('#ttlsts').siblings('.hf').children('input').attr('placeholder', 'MM/DD/YYYY');
        $('#ttlsts').siblings('.hf').children('input').siblings('div').children('span').text('');
        $('#ttlsts').siblings('.hf').children('input').removeClass('input-validation-error');

        $('#titleStatus').find('option:first').prop('selected', 'selected');
        $('#tagscloudTitleStatus').children('span').text('');
        $('#titleStatus').removeClass('input-validation-error');

        $('#idNumber').val("");
        $('#tagscloudIDNumber').children('span').text('');
        $('#idNumber').removeClass('input-validation-error');
        $('#idNumberDiv').hide();
    });
    $('#btnMonthlyLoanFeeReceipt').click(function () {
        ChangeButtonColor(this);
        $('#hdnSelectedButton').val('MonthlyLoanFeeReceipt');
        $('#tagscloudBranch').children('span').text("");
        $("#branchSelect").removeClass('input-validation-error');
        $('#divBranch').hide();
        // $('#lnum').show();
        $('#ttlsts').hide().siblings('.hf').show();
        $('#ttlsts').siblings('.hf').children('input').val('');
        $('#ttlsts').siblings('.hf').children('input').attr('placeholder', 'MM/DD/YYYY');
        $('#ttlsts').siblings('.hf').children('input').siblings('div').children('span').text('');
        $('#ttlsts').siblings('.hf').children('input').removeClass('input-validation-error');

        $('#titleStatus').find('option:first').prop('selected', 'selected');
        $('#tagscloudTitleStatus').children('span').text('');
        $('#titleStatus').removeClass('input-validation-error');

        $('#idNumber').val("");
        $('#tagscloudIDNumber').children('span').text('');
        $('#idNumber').removeClass('input-validation-error');
        $('#idNumberDiv').hide();
    });
    $('#btnLotInspectionFeeReceipt').click(function () {
        ChangeButtonColor(this);
        $('#hdnSelectedButton').val('LotInspectionFeeReceipt');
        $('#tagscloudBranch').children('span').text("");
        $("#branchSelect").removeClass('input-validation-error');
        $('#divBranch').hide();
        // $('#lnum').show();
        $('#ttlsts').hide().siblings('.hf').show();
        $('#ttlsts').siblings('.hf').children('input').val('');
        $('#ttlsts').siblings('.hf').children('input').attr('placeholder', 'MM/DD/YYYY');
        $('#ttlsts').siblings('.hf').children('input').siblings('div').children('span').text('');
        $('#ttlsts').siblings('.hf').children('input').removeClass('input-validation-error');

        $('#titleStatus').find('option:first').prop('selected', 'selected');
        $('#tagscloudTitleStatus').children('span').text('');
        $('#titleStatus').removeClass('input-validation-error');

        $('#idNumber').val("");
        $('#tagscloudIDNumber').children('span').text('');
        $('#idNumber').removeClass('input-validation-error');
        $('#idNumberDiv').hide();
    });

    $('#btnTitlesStatus').click(function () {
        ChangeButtonColor(this);
        $('#hdnSelectedButton').val('TitlesStatus');
        $('#tagscloudBranch').children('span').text("");
        $("#branchSelect").removeClass('input-validation-error');
        $('#divBranch').hide();
        // $('#lnum').show();
        $('#ttlsts').show().siblings('.hf').hide();
        $('#ttlsts').siblings('.hf').children('input').val('');
        $('#ttlsts').siblings('.hf').children('input').attr('placeholder', 'MM/DD/YYYY');
        $('#ttlsts').siblings('.hf').children('input').siblings('div').children('span').text('');
        $('#ttlsts').siblings('.hf').children('input').removeClass('input-validation-error');

        $('#idNumber').val("");
        $('#tagscloudIDNumber').children('span').text('');
        $('#idNumber').removeClass('input-validation-error');
        $('#idNumberDiv').hide();
    });

    $('#titleStatus').change(function () {
        $('#errorMsg').text('');
    });

    $('#btnFullInventory').click(function () {
        ChangeButtonColor(this);
        $('#hdnSelectedButton').val('FullInventory');
        $('#tagscloudBranch').children('span').text("");
        $("#branchSelect").removeClass('input-validation-error');
        $('#divBranch').hide();
          $('#lnum').show();
          $('#lnum').siblings('.hf').hide();
          $('#lnum').siblings('.hf').children('input').val('');

        $('#titleStatus').find('option:first').prop('selected', 'selected');
        $('#tagscloudTitleStatus').children('span').text('');
        $('#titleStatus').removeClass('input-validation-error');

        $('#idNumber').val("");
        $('#tagscloudIDNumber').children('span').text('');
        $('#idNumber').removeClass('input-validation-error');
        $('#idNumberDiv').hide();
    });

    $('#btnAdvanceUnit').click(function () {
        ChangeButtonColor(this);
        $('#hdnSelectedButton').val('AdvanceUnit');
        $('#tagscloudBranch').children('span').text("");
        $("#branchSelect").removeClass('input-validation-error');
        $('#divBranch').hide();
        //   $('#lnum').show();
        $('#ttlsts').hide().siblings('.hf').show();
        $('#ttlsts').siblings('.hf').children('input').val('');
        $('#ttlsts').siblings('.hf').children('input').attr('placeholder', 'MM/DD/YYYY');
        $('#ttlsts').siblings('.hf').children('input').siblings('div').children('span').text('');
        $('#ttlsts').siblings('.hf').children('input').removeClass('input-validation-error');

        $('#titleStatus').find('option:first').prop('selected', 'selected');
        $('#tagscloudTitleStatus').children('span').text('');
        $('#titleStatus').removeClass('input-validation-error');

        $('#idNumber').val("");
        $('#tagscloudIDNumber').children('span').text('');
        $('#idNumber').removeClass('input-validation-error');
        $('#idNumberDiv').hide();
    });

    $('#btnAdvFeeInv').click(function () {
        ChangeButtonColor(this);
        $('#hdnSelectedButton').val('AdvanceFeeInvoice');
        $('#tagscloudBranch').children('span').text("");
        $("#branchSelect").removeClass('input-validation-error');
        $('#divBranch').hide();
        //   $('#lnum').show();
        $('#ttlsts').hide().siblings('.hf').show();
        $('#ttlsts').siblings('.hf').children('input').val('');
        $('#ttlsts').siblings('.hf').children('input').attr('placeholder', 'MM/DD/YYYY');
        $('#ttlsts').siblings('.hf').children('input').siblings('div').children('span').text('');
        $('#ttlsts').siblings('.hf').children('input').removeClass('input-validation-error');

        $('#titleStatus').find('option:first').prop('selected', 'selected');
        $('#tagscloudTitleStatus').children('span').text('');
        $('#titleStatus').removeClass('input-validation-error');

        $('#idNumber').val("");
        $('#tagscloudIDNumber').children('span').text('');
        $('#idNumber').removeClass('input-validation-error');
        $('#idNumberDiv').hide();
    });

    $('#btnAdvFeeRec').click(function () {
        ChangeButtonColor(this);
        $('#hdnSelectedButton').val('AdvanceFeeReciept');
        $('#tagscloudBranch').children('span').text("");
        $("#branchSelect").removeClass('input-validation-error');
        $('#divBranch').hide();
        //  $('#lnum').show();
        $('#ttlsts').hide().siblings('.hf').show();
        $('#ttlsts').siblings('.hf').children('input').val('');
        $('#ttlsts').siblings('.hf').children('input').attr('placeholder', 'MM/DD/YYYY');
        $('#ttlsts').siblings('.hf').children('input').siblings('div').children('span').text('');
        $('#ttlsts').siblings('.hf').children('input').removeClass('input-validation-error');

        $('#titleStatus').find('option:first').prop('selected', 'selected');
        $('#tagscloudTitleStatus').children('span').text('');
        $('#titleStatus').removeClass('input-validation-error');

        $('#idNumber').val("");
        $('#tagscloudIDNumber').children('span').text('');
        $('#idNumber').removeClass('input-validation-error');
        $('#idNumberDiv').hide();
    });

    $('#btnLoanFeeInv').click(function () {
        ChangeButtonColor(this);
        $('#hdnSelectedButton').val('LoanFeeInvoice');
        $('#tagscloudBranch').children('span').text("");
        $("#branchSelect").removeClass('input-validation-error');
        $('#divBranch').hide();
        //  $('#lnum').show();
        $('#ttlsts').hide().siblings('.hf').show();
        $('#ttlsts').siblings('.hf').children('input').val('');
        $('#ttlsts').siblings('.hf').children('input').attr('placeholder', 'MM/DD/YYYY');
        $('#ttlsts').siblings('.hf').children('input').siblings('div').children('span').text('');
        $('#ttlsts').siblings('.hf').children('input').removeClass('input-validation-error');

        $('#titleStatus').find('option:first').prop('selected', 'selected');
        $('#tagscloudTitleStatus').children('span').text('');
        $('#titleStatus').removeClass('input-validation-error');

        $('#idNumber').val("");
        $('#tagscloudIDNumber').children('span').text('');
        $('#idNumber').removeClass('input-validation-error');
        $('#idNumberDiv').hide();
    });

    $('#btnLoanFeeRec').click(function () {
        ChangeButtonColor(this);
        $('#hdnSelectedButton').val('LoanFeeReciept');
        $('#tagscloudBranch').children('span').text("");
        $("#branchSelect").removeClass('input-validation-error');
        $('#divBranch').hide();
        $('#ttlsts').hide().siblings('.hf').show();
        $('#ttlsts').siblings('.hf').children('input').val('');
        $('#ttlsts').siblings('.hf').children('input').attr('placeholder', 'MM/DD/YYYY');
        $('#ttlsts').siblings('.hf').children('input').siblings('div').children('span').text('');
        $('#ttlsts').siblings('.hf').children('input').removeClass('input-validation-error');

        $('#titleStatus').find('option:first').prop('selected', 'selected');
        $('#tagscloudTitleStatus').children('span').text('');
        $('#titleStatus').removeClass('input-validation-error');

        $('#idNumber').val("");
        $('#tagscloudIDNumber').children('span').text('');
        $('#idNumber').removeClass('input-validation-error');
        $('#idNumberDiv').hide();
    });

    $('#btnLotInsFeeInv').click(function () {
        ChangeButtonColor(this);
        $('#hdnSelectedButton').val('LotInspectionFeeInvoice');
        $('#tagscloudBranch').children('span').text("");
        $("#branchSelect").removeClass('input-validation-error');
        $('#divBranch').hide();
        //  $('#lnum').show();
        $('#ttlsts').hide().siblings('.hf').show();
        $('#ttlsts').siblings('.hf').children('input').val('');
        $('#ttlsts').siblings('.hf').children('input').attr('placeholder', 'MM/DD/YYYY');
        $('#ttlsts').siblings('.hf').children('input').siblings('div').children('span').text('');
        $('#ttlsts').siblings('.hf').children('input').removeClass('input-validation-error');

        $('#titleStatus').find('option:first').prop('selected', 'selected');
        $('#tagscloudTitleStatus').children('span').text('');
        $('#titleStatus').removeClass('input-validation-error');

        $('#idNumber').val("");
        $('#tagscloudIDNumber').children('span').text('');
        $('#idNumber').removeClass('input-validation-error');
        $('#idNumberDiv').hide();
    });

    $('#btnLotInsFeeRec').click(function () {
        ChangeButtonColor(this);
        $('#hdnSelectedButton').val('LotInspectionFeeReciept');
        $('#tagscloudBranch').children('span').text("");
        $("#branchSelect").removeClass('input-validation-error');
        $('#divBranch').hide();
        //    $('#lnum').show();
        $('#ttlsts').hide().siblings('.hf').show();
        $('#ttlsts').siblings('.hf').children('input').val('');
        $('#ttlsts').siblings('.hf').children('input').attr('placeholder', 'MM/DD/YYYY');
        $('#ttlsts').siblings('.hf').children('input').siblings('div').children('span').text('');
        $('#ttlsts').siblings('.hf').children('input').removeClass('input-validation-error');

        $('#titleStatus').find('option:first').prop('selected', 'selected');
        $('#tagscloudTitleStatus').children('span').text('');
        $('#titleStatus').removeClass('input-validation-error');

        $('#idNumber').val("");
        $('#tagscloudIDNumber').children('span').text('');
        $('#idNumber').removeClass('input-validation-error');
        $('#idNumberDiv').hide();
    });

    $('#btnPayOff').click(function () {
        ChangeButtonColor(this);
        $('#hdnSelectedButton').val('PayOff');
        $('#tagscloudBranch').children('span').text("");
        $("#branchSelect").removeClass('input-validation-error');
        $('#divBranch').hide();
        //  $('#lnum').show();
        $('#ttlsts').hide().siblings('.hf').show();
        $('#ttlsts').siblings('.hf').children('input').val('');
        $('#ttlsts').siblings('.hf').children('input').attr('placeholder', 'MM/DD/YYYY');
        $('#ttlsts').siblings('.hf').children('input').siblings('div').children('span').text('');
        $('#ttlsts').siblings('.hf').children('input').removeClass('input-validation-error');

        $('#titleStatus').find('option:first').prop('selected', 'selected');
        $('#tagscloudTitleStatus').children('span').text('');
        $('#titleStatus').removeClass('input-validation-error');

        $('#idNumber').val("");
        $('#tagscloudIDNumber').children('span').text('');
        $('#idNumber').removeClass('input-validation-error');
        $('#idNumberDiv').hide();
    });

    $('#btnTransactionHistory').click(function () {
        ChangeButtonColor(this);
        $('#hdnSelectedButton').val('TransactionHistory');
        $('#tagscloudBranch').children('span').text("");
        $("#branchSelect").removeClass('input-validation-error');
        $('#divBranch').hide();
        //  $('#lnum').show();
        $('#ttlsts').hide().siblings('.hf').show();
        $('#ttlsts').siblings('.hf').children('input').val('');
        $('#ttlsts').siblings('.hf').children('input').attr('placeholder', 'MM/DD/YYYY');
        $('#ttlsts').siblings('.hf').children('input').siblings('div').children('span').text('');
        $('#ttlsts').siblings('.hf').children('input').removeClass('input-validation-error');

        $('#titleStatus').find('option:first').prop('selected', 'selected');
        $('#tagscloudTitleStatus').children('span').text('');
        $('#titleStatus').removeClass('input-validation-error');
        $('#idNumber').val("");
        $('#tagscloudIDNumber').children('span').text('');
        $('#idNumber').removeClass('input-validation-error');
        $('#idNumberDiv').hide();
    });

    $('#btnLoanTerms').click(function () {
        ChangeButtonColor(this);
        $('#hdnSelectedButton').val('LoanTerms');
        $('#tagscloudBranch').children('span').text("");
        $("#branchSelect").removeClass('input-validation-error');
        $('#divBranch').hide();
        //  $('#lnum').siblings('.hf').hide();
        //  $('#lnum').siblings('.hf').children('input').val('');

        $('#titleStatus').find('option:first').prop('selected', 'selected');
        $('#tagscloudTitleStatus').children('span').text('');
        $('#titleStatus').removeClass('input-validation-error');


        $('#tagscloudStartDate').children('span').text('');
        $('#startDate').removeClass('input-validation-error');
        $('#strdate').hide();
        $('#tagscloudEndDate').children('span').text('');
        $('#endDate').removeClass('input-validation-error');
        $('#enddate').hide();

        $('#idNumber').val("");
        $('#tagscloudIDNumber').children('span').text('');
        $('#idNumber').removeClass('input-validation-error');
        $('#idNumberDiv').hide();
        //$('#btnPrint').show();
        //$('#reportViewerDiv').show();
    });

    $('#btnCompanySummary').click(function () {
        ChangeButtonColor(this);
        $('#hdnSelectedButton').val('CompanySummary');
        $('#tagscloudBranch').children('span').text("");
        $("#branchSelect").removeClass('input-validation-error');
        $('#divBranch').hide();
        $('#idNumber').val("");
        $('#tagscloudIDNumber').children('span').text('');
        $('#idNumber').removeClass('input-validation-error');
        $('#idNumberDiv').hide();

        $('#tagscloudStartDate').children('span').text('');
        $('#startDate').removeClass('input-validation-error');
        $('#strdate').hide();
        $('#tagscloudEndDate').children('span').text('');
        $('#endDate').removeClass('input-validation-error');
        $('#enddate').hide();
        //$('#btnPrint').show();
        //$('#reportViewerDiv').show();
    });

    $('#btnBranchSummary').click(function () {
        ChangeButtonColor(this);
        $('#hdnSelectedButton').val('BranchSummary');
        $('#strdate').hide();
        $('#enddate').hide();
        $('#lnum').show();
        $('#ttlsts').hide();
        $('#divBranch').show();

        @if (ViewBag.RoleId == 1)
        {
             if (ViewBag.BranchSelectList.Count == 1) {
                <text>
        $('#branchSelect').val('@ViewBag.BranchSelectList[0].Value');
        </text>
             }

        }

        $('#idNumber').val("");
        $('#tagscloudIDNumber').children('span').text('');
        $('#idNumber').removeClass('input-validation-error');
        $('#idNumberDiv').hide();
    });

    $('#btnDeletedUnits').click(function () {
        ChangeButtonColor(this);
        //   $('#lnum').show();
        $('#hdnSelectedButton').val('DeletedUnits');
        $('#ttlsts').hide().siblings('.hf').show();
        $('#tagscloudBranch').children('span').text("");
        $("#branchSelect").removeClass('input-validation-error');
        $('#divBranch').hide();
        $('#ttlsts').siblings('.hf').children('input').val('');
        $('#ttlsts').siblings('.hf').children('input').attr('placeholder', 'MM/DD/YYYY');
        $('#ttlsts').siblings('.hf').children('input').siblings('div').children('span').text('');
        $('#ttlsts').siblings('.hf').children('input').removeClass('input-validation-error');

        $('#titleStatus').find('option:first').prop('selected', 'selected');
        $('#tagscloudTitleStatus').children('span').text('');
        $('#titleStatus').removeClass('input-validation-error');

        $('#idNumber').val("");
        $('#tagscloudIDNumber').children('span').text('');
        $('#idNumber').removeClass('input-validation-error');
        $('#idNumberDiv').hide();
    });

    $('#btnLoanSummary').click(function () {
        ChangeButtonColor(this);
        $('#hdnSelectedButton').val('LoanSummary');
        $('#tagscloudBranch').children('span').text("");
        $("#branchSelect").removeClass('input-validation-error');
        $('#divBranch').hide();
        //   $('#lnum').show();
        $('#ttlsts').hide().siblings('.hf').show();
        $('#ttlsts').siblings('.hf').children('input').val('');
        $('#ttlsts').siblings('.hf').children('input').attr('placeholder', 'MM/DD/YYYY');
        $('#ttlsts').siblings('.hf').children('input').siblings('div').children('span').text('');
        $('#ttlsts').siblings('.hf').children('input').removeClass('input-validation-error');

        $('#titleStatus').find('option:first').prop('selected', 'selected');
        $('#tagscloudTitleStatus').children('span').text('');
        $('#titleStatus').removeClass('input-validation-error');

        $('#idNumber').val("");
        $('#tagscloudIDNumber').children('span').text('');
        $('#idNumber').removeClass('input-validation-error');
        $('#idNumberDiv').hide();
    });
    $('#btnFullCurtSummary').click(function () {
        ChangeButtonColor(this);
        $('#hdnSelectedButton').val('FullCurtSummary');
        $('#tagscloudBranch').children('span').text("");
        $("#branchSelect").removeClass('input-validation-error');
        $('#divBranch').hide();
        $('#strdate').hide();
        $('#enddate').hide();
        $('#lnum').show();
        $('#ttlsts').hide();
        $('#idNumberDiv').hide();
        $('#idNumber').val("");
        $('#tagscloudIDNumber').children('span').text('');
        $('#idNumber').removeClass('input-validation-error');
    });
    $('#btnIndCurtSummary').click(function () {
        ChangeButtonColor(this);
        $('#hdnSelectedButton').val('IndCurtSummary');
        $('#tagscloudBranch').children('span').text("");
        $("#branchSelect").removeClass('input-validation-error');
        $('#divBranch').hide();
        $('#strdate').hide();
        $('#enddate').hide();
        $('#lnum').show();
        $('#ttlsts').hide();
        $('#idNumberDiv').show();
    });

    $('#idNumber').click(function () {

        $('#tagscloudIDNumber').children('span').text('');
        $('#idNumber').removeClass('input-validation-error');
    });
    $('#idNumber').focusout(function () {
        var len2 = $('#idNumber').val();

        if ($('#idNumber').val() !== "") {
            if (len2.length < 6) {

                $('#tagscloudIDNumber').children('span').text('Please enter the last 6 characters for the VIN/HIN/Serial # you are wanting to view the curtailment summary for.');
                $('#idNumber').addClass('input-validation-error');
                //$('.centered h5 span').text("Error in Page");
            }
            else {
                $('#tagscloudIDNumber').children('span').text('');
                $('#idNumber').removeClass('input-validation-error');
                //$('.centered h5 span').text("");
            }

        }
        else if ($('#idNumber').val() === "") {
            $('#tagscloudIDNumber').children('span').text('Please enter the last 6 characters for the VIN/HIN/Serial # you are wanting to view the curtailment summary for.');
            $('#idNumber').addClass('input-validation-error');
            //$('.centered h5 span').text("Error in Page");
        }

    });
    $('#idNumber').blur(function () {
        if ($('#idNumber').val() !== "") {
            if (len2.length < 6) {

                $('#tagscloudIDNumber').children('span').text('Please enter the last 6 characters for the VIN/HIN/Serial # you are wanting to view the curtailment summary for.');
                $('#idNumber').addClass('input-validation-error');
                // $('.centered h5 span').text("Error in Page");
            }
            else {
                $('#tagscloudIDNumber').children('span').text('');
                $('#idNumber').removeClass('input-validation-error');
                //$('.centered h5 span').text("");
            }
        }
        else if ($('#idNumber').val() === "") {
            $('#tagscloudIDNumber').children('span').text('Please confirm the last 6 characters of the VIN/HIN/Serial No.');
            $('#idNumber').addClass('input-validation-error');
            //$('.centered h5 span').text("Error in Page");
        }
    });
    function ReportCurtailmentInvoice(val, url) {

        var myFrame = document.getElementById('ifrmReportViewer');

        if (myFrame !== null) {

            if (myFrame.src) {
                myFrame.src = url;
            } else if (myFrame.contentWindow !== null && myFrame.contentWindow.location !== null) {
                myFrame.contentWindow.location = url;
            } else {
                myFrame.setAttribute('src', url);
            }
        }
        //$('#reportViewerDiv').show();
        //$('#btnPrint').show();
    }

    $('#btnDisplay').click(function () {

        errorCount = 0;
        var rptType = $('#hdnSelectedButton').val();
        var branchId = 0;
        var branchName = "";

        // if report type is company summary or branch summary
        if (rptType === 'CompanySummary' || rptType === 'BranchSummary') {

            if (rptType === 'CompanySummary') {
                urlPrefix = "../Reports/RptDivCompanySummary.aspx?companyId=";//
            }
            else if (rptType === 'BranchSummary') {
                urlPrefix = "../Reports/RptDivBranchSummary.aspx?branchId=";
            }

            if (rptType === 'CompanySummary' && '@ViewBag.RoleId' === '1') {
                var comId = '@ViewBag.ComId';

                myFrame = document.getElementById('ifrmReportViewer');
                frameDoc = myFrame.contentDocument || myFrame.contentWindow.document;
                frameDoc.removeChild(frameDoc.documentElement);

                urlPrefix = urlPrefix + comId;
                ReportCurtailmentInvoice(val, urlPrefix);
            }
            else if (rptType === 'BranchSummary') {
                if ('@ViewBag.RoleId' != 1) {
                    branchId = '@ViewBag.BranchId';
                }
                else {
                    branchId = $('#branchSelect').val();
                    branchName = $('#branchSelect option:selected').text();

                }

                if (branchId > 0 && branchId != "") {
                    myFrame = document.getElementById('ifrmReportViewer');
                    frameDoc = myFrame.contentDocument || myFrame.contentWindow.document;
                    frameDoc.removeChild(frameDoc.documentElement);

                    urlPrefix = urlPrefix + branchId + '&branchName=' + branchName;
                    ReportCurtailmentInvoice(val, urlPrefix);
                }
                else {
                    $('#tagscloudBranch').children('span').text("Please select which branch of your company you would like to view a summary report for.");
                    $("#branchSelect").addClass('input-validation-error');
                    $('.centered h5 span').text("Error in Page");
                }
            }
            return;
        }

        var selectedIndex;


        selectedIndex = $("#loanId").val(); @*// set the loan id*@
        @*// if loan id is not selected*@
        if (selectedIndex === '') {

            $("#LoanId").addClass('input-validation-error');
            $('.centered h5 span').text("Please select a loan");
            errorCount = errorCount + 1;
        } else {

            $("#LoanId").removeClass('input-validation-error');
            $('.centered h5 span').text("");

            if (rptType !== '') {
                var input = $("#loanId");

                var urlPrefix = "";

                if (rptType === 'LotInspection') {
                    urlPrefix = "../Reports/RptDivLotInspection.aspx?loanId=";
                }
                else if (rptType === 'CurtailmentInvoice') {
                    urlPrefix = "../Reports/RptDivCurtailmentInvoice.aspx?loanId=";
                }
                else if (rptType === 'CurtailmentReceipt') {
                    urlPrefix = "../Reports/RptDivCurtailmentReceipt.aspx?loanId=";
                }
                else if (rptType === 'TitlesStatus') {
                    urlPrefix = "../Reports/RptDivTitleStatus.aspx?loanId=";
                }
                else if (rptType === 'FullInventory') {
                    urlPrefix = "../Reports/RptDivFullInventory.aspx?loanId=";
                }
                else if (rptType === 'PayOff') {
                    urlPrefix = "../Reports/RptDivPayOff.aspx?loanId=";
                }
                else if (rptType === 'AdvanceFeeReceipt') {
                    urlPrefix = "../Reports/RptDivAdvanceFeeReceipt.aspx?loanId=";
                }
                else if (rptType === 'AdvanceFeeInvoice') {
                    urlPrefix = "../Reports/RptDivAdvanceFeeInvoice.aspx?loanId=";
                }
                else if (rptType === 'LoanFeeInvoice') {
                    urlPrefix = "../Reports/RptDivMonthlyLoanFeeInvoice.aspx?loanId=";
                }
                else if (rptType === 'LotInspectionFeeInvoice') {
                    urlPrefix = "../Reports/RptDivLotInspectionFeeInvoice.aspx?loanId=";
                }
                else if (rptType === 'MonthlyLoanFeeReceipt') {
                    urlPrefix = "../Reports/RptDivMonthlyLoanFeeReceipt.aspx?loanId=";
                }
                else if (rptType === 'LotInspectionFeeReceipt') {
                    urlPrefix = "../Reports/RptDivLotInspectionFeeReceipt.aspx?loanId=";
                }
                else if (rptType === 'TransactionHistory') {
                    urlPrefix = "../Reports/RptDivTransactionHistory.aspx?loanId=";
                }
                else if (rptType === 'AdvanceUnit') {
                    urlPrefix = "../Reports/RptAdvanceUnitReport.aspx?loanId=";
                }
                else if (rptType === 'LoanTerms') {
                    urlPrefix = "../Reports/RptDivLoanTerms.aspx?loanId=";
                }

                else if (rptType === 'DeletedUnits') {
                    urlPrefix = "../Reports/RptDivDeletedUnits.aspx?loanId=";
                }
                else if (rptType === 'LoanSummary') {
                    urlPrefix = "../Reports/RptDivLoanSummary.aspx?loanId=";
                }
                else if (rptType === 'FullCurtSummary') {
                    urlPrefix = "../Reports/RptDivFullCurtailmentSummary.aspx?loanId=";
                }
                else if (rptType === 'IndCurtSummary') {

                    urlPrefix = "../Reports/RptDivIndividualCurtailmentSummary.aspx?loanId=";

                }

                var val = selectedIndex;

                var myFrame;
                var frameDoc;

                if (rptType === 'CurtailmentInvoice' || rptType === 'CurtailmentReceipt' || rptType === 'PayOff' || rptType === 'AdvanceFeeInvoice' || rptType === 'LoanFeeInvoice' || rptType === 'LotInspectionFeeInvoice' || rptType === 'PayOff' || rptType === 'AdvanceFeeReceipt' ||
                    rptType === 'MonthlyLoanFeeReceipt' || rptType === 'LotInspectionFeeReceipt' || rptType === 'TransactionHistory' || rptType === 'AdvanceUnit' || rptType === 'DeletedUnits' || rptType === 'LoanSummary') {

                    var startDate = $('#startDate').val();
                    if (startDate === '') {
                        $('#tagscloudStartDate').children('span').text("Please select start date");
                        $("#startDate").addClass('input-validation-error');
                        $('.centered h5 span').text("Error in Page");
                        errorCount = errorCount + 1;
                    } else {
                        $('#tagscloudStartDate').children('span').text("");
                        $("#startDate").removeClass('input-validation-error');
                        $('.centered h5 span').text("");
                    }

                    var endDate = $('#endDate').val();
                    if (endDate === '') {
                        $('#tagscloudEndDate').children('span').text("Please select end date");
                        $("#endDate").addClass('input-validation-error');
                        errorCount = errorCount + 1;
                    } else {
                        $('#tagscloudEndDate').children('span').text("");
                        $("#endDate").removeClass('input-validation-error');
                    }

                    if (errorCount > 0) {
                        $('.centered h5 span').text("Error in Page");
                    }

                    if (errorCount <= 0) {

                        if (new Date(startDate) >= new Date(endDate)) {
                            $('#tagscloudEndDate').children('span').text("Please select an end date which falls after the start date selected.");
                            $("#startDate").addClass('input-validation-error');
                            $("#endDate").addClass('input-validation-error');
                            $('.centered h5 span').text("Error in Page");
                            return;
                        }

                        $('#tagscloudEndDate').children('span').text("");
                        $("#startDate").removeClass('input-validation-error');
                        $("#endDate").removeClass('input-validation-error');

                        myFrame = document.getElementById('ifrmReportViewer');
                        frameDoc = myFrame.contentDocument || myFrame.contentWindow.document;
                        frameDoc.removeChild(frameDoc.documentElement);


                        urlPrefix = urlPrefix + val + "&startDate=" + formatDate(startDate) + "&endDate=" + formatDate(endDate);
                        ReportCurtailmentInvoice(val, urlPrefix);
                    }
                } else if (rptType === 'LotInspection' || rptType === 'LoanTerms') {
                    if (errorCount <= 0) {
                        myFrame = document.getElementById('ifrmReportViewer');
                        frameDoc = myFrame.contentDocument || myFrame.contentWindow.document;
                        frameDoc.removeChild(frameDoc.documentElement);

                        urlPrefix = urlPrefix + val;
                        ReportCurtailmentInvoice(val, urlPrefix);
                    }
                } else if (rptType === 'TitlesStatus') {
                    selectedIndex = $("#titleStatus option:selected").index();
                    if (selectedIndex === 0) {
                        $('#tagscloudTitleStatus').children('span').text("Please select title status");
                        $("#titleStatus").addClass('input-validation-error');
                        $('.centered h5 span').text("Error in Page");
                        errorCount = errorCount + 1;
                    } else {

                        if (errorCount <= 0) {
                            $('#tagscloudTitleStatus').children('span').text("");
                            $("#titleStatus").removeClass('input-validation-error');
                            $('.centered h5 span').text("");
                            myFrame = document.getElementById('ifrmReportViewer');
                            frameDoc = myFrame.contentDocument || myFrame.contentWindow.document;
                            frameDoc.removeChild(frameDoc.documentElement);

                            urlPrefix = urlPrefix + val + '&titleStatus=' + $('#titleStatus').val();
                            ReportCurtailmentInvoice(val, urlPrefix);
                        }
                    }
                }
                else if (rptType === 'FullInventory') {
                    if (errorCount <= 0) {
                        myFrame = document.getElementById('ifrmReportViewer');
                        frameDoc = myFrame.contentDocument || myFrame.contentWindow.document;
                        frameDoc.removeChild(frameDoc.documentElement);

                        urlPrefix = urlPrefix + val;
                        ReportCurtailmentInvoice(val, urlPrefix);
                    }
                }
                else if (rptType === 'FullCurtSummary') {
                    if (errorCount <= 0) {
                        myFrame = document.getElementById('ifrmReportViewer');
                        frameDoc = myFrame.contentDocument || myFrame.contentWindow.document;
                        frameDoc.removeChild(frameDoc.documentElement);

                        urlPrefix = urlPrefix + val;
                        ReportCurtailmentInvoice(val, urlPrefix);
                    }
                }
                else if (rptType === 'IndCurtSummary') {
                    var idType = $("#idNumber").val();
                    var len = $("#idNumber").val().length;

                    if (idType === null || idType === "") {
                        $('#tagscloudIDNumber').children('span').text("Please enter the last 6 characters for the VIN/HIN/Serial # you are wanting to view the curtailment summary for.");
                        $("#idNumber").addClass('input-validation-error');
                        $('.centered h5 span').text("Error in Page");
                        errorCount = errorCount + 1;
                    }
                    else if (len < 6) {
                        $('#tagscloudIDNumber').children('span').text("Please enter the last 6 characters for the VIN/HIN/Serial # you are wanting to view the curtailment summary for.");
                        $("#idNumber").addClass('input-validation-error');
                        $('.centered h5 span').text("Error in Page");
                        errorCount = errorCount + 1;
                    } else {

                        if (errorCount <= 0) {
                            $('#tagscloudIDNumber').children('span').text("");
                            $("#idNumber").removeClass('input-validation-error');
                            $('.centered h5 span').text("");
                            myFrame = document.getElementById('ifrmReportViewer');
                            frameDoc = myFrame.contentDocument || myFrame.contentWindow.document;
                            frameDoc.removeChild(frameDoc.documentElement);

                            urlPrefix = urlPrefix + val + '&idNumber=' + $('#idNumber').val() + '&branchName=' + $('#branchName').val();

                            ReportCurtailmentInvoice(val, urlPrefix);
                        }
                    }

                }
            } else {
                $('.centered h5 span').text("Please select report type");
            }
        }



    });

    function formatDate(date) {
        var d = new Date(date),
            month = '' + (d.getMonth() + 1),
            day = '' + d.getDate(),
            year = d.getFullYear();

        if (month.length < 2) month = '0' + month;
        if (day.length < 2) day = '0' + day;

        return [month, day, year].join('/');
    }

    function isValidDate(dateString) {
        // First check for the pattern
        if (!/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(dateString))
            return false;

        // Parse the date parts to integers
        var parts = dateString.split("/");
        var day = parseInt(parts[1], 10);
        var month = parseInt(parts[0], 10);
        var year = parseInt(parts[2], 10);

        // Check the ranges of month and year
        if (year < 1000 || year > 3000 || month === 0 || month > 12)
            return false;

        var monthLength = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];

        // Adjust for leap years
        if (year % 400 === 0 || (year % 100 !== 0 && year % 4 === 0))
            monthLength[1] = 29;

        // Check the range of the day
        return day > 0 && day <= monthLength[month - 1];
    };


    $('#startDate').blur(function () {
        var valid = isValidDate($(this).val());
        if (valid) {
            $('#tagscloudStartDate').children('span').text('');
            $(this).removeClass('input-validation-error');
            var endDate = $('#endDate').val();

            if (endDate !== '') {
                if (new Date(this.value) >= new Date(endDate)) {
                    $('#tagscloudEndDate').children('span').text("Please select an end date which falls after the start date selected.");
                    $("#startDate").addClass('input-validation-error');
                    $("#endDate").addClass('input-validation-error');
                    $('.centered h5 span').text("Error in Page");
                    return;
                }

                $('#tagscloudEndDate').children('span').text("");
                $("#startDate").removeClass('input-validation-error');
                $("#endDate").removeClass('input-validation-error');
                $('.centered h5 span').text("");
            }


        } else {

            // not valid data error
            $('#tagscloudStartDate').children('span').text('Not valid date');
            $(this).addClass('input-validation-error');
        }

        if ($('#startDate').val() === '') {
            $('#tagscloudStartDate').children('span').text('');
            $(this).removeClass('input-validation-error');
            $(this).attr("placeholder", "MM/DD/YYYY");
        }

    });

    $('#endDate').blur(function () {
        var valid = isValidDate($(this).val());
        if (valid) {
            var startDate = $('#startDate').val();

            if (new Date(startDate) >= new Date(this.value)) {
                $('#tagscloudEndDate').children('span').text("Please select an end date which falls after the start date selected.");
                $("#startDate").addClass('input-validation-error');
                $("#endDate").addClass('input-validation-error');
                $('.centered h5 span').text("Error in Page");
                return;
            }

            $('#tagscloudEndDate').children('span').text("");
            $("#startDate").removeClass('input-validation-error');
            $("#endDate").removeClass('input-validation-error');
            $('.centered h5 span').text("");
        } else {

            // not valid data error
            $('#tagscloudEndDate').children('span').text('Not valid date');
            $(this).addClass('input-validation-error');
        }

        if ($('#endDate').val() === '') {
            $('#tagscloudEndDate').children('span').text('');
            $(this).removeClass('input-validation-error');
            $(this).attr("placeholder", "MM/DD/YYYY");
        }

    });



    $('#titleStatus').change(function () {
        $('#tagscloudTitleStatus').children('span').text('');
        $(this).removeClass('input-validation-error');

        var rptType = $('#hdnSelectedButton').val();
        if (rptType === 'TitlesStatus') {
            if (this.value !== '' && $("#LoanId option:selected").index() !== 0)
                $('.centered h5 span').text("");
        }
    });

    $('#btnPrint').click(function () {
        //Filtering section
        var rptType = $('#hdnSelectedButton').val(); //report name
        var loanId = $("#loanId").val(); //loan id
        var range1 = $('#startDate').val(); //Begin date
        var range2 = $('#endDate').val(); //End date
        var titleStatus = $('#titleStatus').val(); //Title status
        var branchId = 0;
        var branchName = "";
        @if (ViewBag.RoleId == 1) {
            <text>var branchId = $('#branchSelect').val();</text>
            <text>var branchName = $('#branchSelect option:selected').text();</text>
        }
        var idNumber = $('#idNumber').val(); //individual curtailment summary

        //Create and store report path
        var url = '/Reports/PrintPage?rptType=' + rptType + '&loanId=' + loanId + '&range1=' + range1 + '&range2=' + range2 + '&titleStatus=' + titleStatus + '&branchId=' + branchId + '&idNumber=' + idNumber + '&branchName=' + branchName;

        //open report in a new page
        var win = window.open(url, '_blank');
        win.focus();
    });

    var startDate = new Pikaday({
        field: document.getElementById('startDate'),
        format: 'l'
    });

    var endDate = new Pikaday({
        field: document.getElementById('endDate'),
        format: 'l'
    });

    // hiding the report button on link bar
    $("#lkrep").hide();

</script>


<script language="javascript">


    $(document).ready(function () {

        var isFirstTime = 0; // variable for selecteing item at first time only

        @if (ViewBag.RoleId == 1) {

                <text>
        // getting and binding datas to the grid
        $("#grid").jqGrid({
            url: '@Href("~/Reports/GetActiveLoans")',
            datatype: "json",
            contentType: "application/json; charset-utf-8",
            mtype: 'GET',
            colNames: ['LoanCode', 'Branch Name', 'Partner Branch Name', 'Loan Number',
             'Loan Amount', 'Used Amount', 'No. of Active Units', 'PatBranchAddress1', 'PatBranchAddress2', 'PatCity'],
            colModel: [
                { name: 'LoanCode', index: 'LoanCode', width: 194, hidden: true },

                 { name: 'BranchName', index: 'BranchName', width: 194 },

                  { name: 'PatBranchName', index: 'PatBranchName', width: 194 },

                { name: 'LoanNumber', index: 'LoanNumber', width: 194 },


                {
                    name: 'LoanAmount', index: 'LoanAmount', width: 136,
                    align: "right", sorttype: 'float', formatter: 'currency',
                    formatoptions: { prefix: '$ ', thousandsSeparator: ',' }
                },
                 {
                     name: 'UsedAmount', index: 'UsedAmount', width: 136,
                     align: "right", sorttype: 'float', formatter: 'currency',
                     formatoptions: { prefix: '$ ', thousandsSeparator: ',' }
                 },
                  {
                      name: 'ActiveUnits', index: 'ActiveUnits', width: 114,
                      align: "right", sorttype: 'int'
                  },

                   { name: 'PatBranchAddress1', index: 'PatBranchAddress1', width: 194, hidden: true },

                    { name: 'PatBranchAddress2', index: 'PatBranchAddress2', width: 194, hidden: true },

                     { name: 'PatCity', index: 'PatCity', width: 194, hidden: true }

            ],

            rowList: [],        // disable page size dropdown
            pgbuttons: false,     // disable page control like next, back button
            pgtext: null,         // disable pager text like 'Page 0 of 10'
            viewrecords: false,    // disable current view record text like 'View 1-10 of 100'
            pager: '#pager2',
            sortname: 'id',
            loadonce: true,
            scrollrows: true,
            sortorder: "asc",
            caption: "Active Loans",
            // changing grid height
            loadComplete: function () {

                var grid = $("#grid"),
            ids = grid.getDataIDs();

                for (var i = 0; i < ids.length; i++) {
                    grid.setRowData(ids[i], false, { height: 27 });
                }

                // if loan selected from dashboard autoselect the row
                @if ((Loan)Session["loanDashboard"] != null)
    {
        <text>
                if (isFirstTime == 0) {
                    var ids = $("#grid").jqGrid("getDataIDs");
                    if (ids.length > 0) {
                        $("#grid").jqGrid("setSelection", '@(((Loan)Session["loanDashboard"]).LoanId)');
                        $("#loanId").val('@(((Loan)Session["loanDashboard"]).LoanId)');

                        DefaultLoanID = $("#loanId").val(); // set global loan id to check change loan
                    }

                    isFirstTime = 1;
                }

                </text>
    }

            }
        });  </text>
        }else if (ViewBag.RoleId == 2)
        {
             <text>
        // getting and binding datas to the grid
        $("#grid").jqGrid({
            url: '@Href("~/Reports/GetActiveLoans")',
            datatype: "json",
            contentType: "application/json; charset-utf-8",
            mtype: 'GET',
            colNames: ['LoanCode', 'Branch Name', 'Partner Branch Name', 'Loan Number',
                 'Loan Amount', 'Used Amount', 'No. of Active Units', 'PatBranchAddress1', 'PatBranchAddress2', 'PatCity'],
            colModel: [
                    { name: 'LoanCode', index: 'LoanCode', width: 194, hidden: true },

                     { name: 'BranchName', index: 'BranchName', width: 194, hidden: true },

                      { name: 'PatBranchName', index: 'PatBranchName', width: 232 },

                    { name: 'LoanNumber', index: 'LoanNumber', width: 232 },


                {
                    name: 'LoanAmount', index: 'LoanAmount', width: 174,
                    align: "right", sorttype: 'float', formatter: 'currency',
                    formatoptions: { prefix: '$ ', thousandsSeparator: ',' }
                },
                 {
                     name: 'UsedAmount', index: 'UsedAmount', width: 174,
                     align: "right", sorttype: 'float', formatter: 'currency',
                     formatoptions: { prefix: '$ ', thousandsSeparator: ',' }
                 },
                      {
                          name: 'ActiveUnits', index: 'ActiveUnits', width: 150,
                          align: "right", sorttype: 'int'
                      },

                       { name: 'PatBranchAddress1', index: 'PatBranchAddress1', width: 194, hidden: true },

                    { name: 'PatBranchAddress2', index: 'PatBranchAddress2', width: 194, hidden: true },

                     { name: 'PatCity', index: 'PatCity', width: 194, hidden: true }

            ],

            rowList: [],        // disable page size dropdown
            pgbuttons: false,     // disable page control like next, back button
            pgtext: null,         // disable pager text like 'Page 0 of 10'
            viewrecords: false,    // disable current view record text like 'View 1-10 of 100'
            pager: '#pager2',
            sortname: 'id',
            loadonce: true,
            scrollrows: true,
            sortorder: "asc",
            caption: "Active Loans",
            // changing grid height
            loadComplete: function () {
                var grid = $("#grid"),
                    ids = grid.getDataIDs();

                for (var i = 0; i < ids.length; i++) {
                    grid.setRowData(ids[i], false, { height: 27 });
                }

                // if loan selected from dashboard autoselect the row
                @if ((Loan)Session["loanDashboard"] != null)
        {
           <text>
                if (isFirstTime == 0) {
                    var ids = $("#grid").jqGrid("getDataIDs");
                    if (ids.length > 0) {
                        $("#grid").jqGrid("setSelection", '@(((Loan)Session["loanDashboard"]).LoanId)');
                        $("#loanId").val('@(((Loan)Session["loanDashboard"]).LoanId)');

                        DefaultLoanID = $("#loanId").val(); // set global loan id to check change loan
                    }
                    isFirstTime = 1;
                }
                </text>
        }

            }
        });  </text>

        }
        else
        {

             <text>
        // getting and binding datas to the grid
        $("#grid").jqGrid({
            url: '@Href("~/Reports/GetActiveLoans")',
            datatype: "json",
            contentType: "application/json; charset-utf-8",
            mtype: 'GET',
            colNames: ['LoanCode', 'Partner Branch Name', 'Loan Number',
                 'Loan Amount', 'Used Amount', 'No. of Active Units', 'PatBranchAddress1', 'PatBranchAddress2', 'PatCity', 'userReportRights'],
            colModel: [
                    { name: 'LoanCode', index: 'LoanCode', width: 194, hidden: true },
                      { name: 'PatBranchName', index: 'PatBranchName', width: 232 },

                    { name: 'LoanNumber', index: 'LoanNumber', width: 232 },


                {
                    name: 'LoanAmount', index: 'LoanAmount', width: 174,
                    align: "right", sorttype: 'float', formatter: 'currency',
                    formatoptions: { prefix: '$ ', thousandsSeparator: ',' }
                },
                 {
                     name: 'UsedAmount', index: 'UsedAmount', width: 174,
                     align: "right", sorttype: 'float', formatter: 'currency',
                     formatoptions: { prefix: '$ ', thousandsSeparator: ',' }
                 },
                      {
                          name: 'ActiveUnits', index: 'ActiveUnits', width: 150,
                          align: "right", sorttype: 'int'
                      },

                       { name: 'PatBranchAddress1', index: 'PatBranchAddress1', width: 194, hidden: true },

                    { name: 'PatBranchAddress2', index: 'PatBranchAddress2', width: 194, hidden: true },

                     { name: 'PatCity', index: 'PatCity', width: 194, hidden: true },

                     { name: 'userReportRights', index: 'userReportRights', width: 194, hidden: true }

            ],

            rowList: [],        // disable page size dropdown
            pgbuttons: false,     // disable page control like next, back button
            pgtext: null,         // disable pager text like 'Page 0 of 10'
            viewrecords: false,    // disable current view record text like 'View 1-10 of 100'
            pager: '#pager2',
            sortname: 'id',
            loadonce: true,
            scrollrows: true,
            sortorder: "asc",
            caption: "Active Loans",
            // changing grid height
            loadComplete: function () {
                var grid = $("#grid"),
                    ids = grid.getDataIDs();

                for (var i = 0; i < ids.length; i++) {
                    grid.setRowData(ids[i], false, { height: 27 });
                }

                // if loan selected from dashboard autoselect the row
                @if ((Loan)Session["loanDashboard"] != null)
        {
           <text>
                if (isFirstTime == 0) {
                    var ids = $("#grid").jqGrid("getDataIDs");
                    if (ids.length > 0) {
                        $("#grid").jqGrid("setSelection", '@(((Loan)Session["loanDashboard"]).LoanId)');
                        $("#loanId").val('@(((Loan)Session["loanDashboard"]).LoanId)');
                    }
                    isFirstTime = 1;
                }
                DefaultLoanID = $("#loanId").val(); // set global loan id to check change loan
                //  change buttons according to the loan
                changeButtons($("#loanId").val());
                </text>
        }

            }
        });  </text>

        }




        // disable edit, add , false on pager
        jQuery("#grid").jqGrid('navGrid', '#pager2',
            { edit: false, add: false, del: false });



        //Frontend page: Report Page
        //Title:   when user click the row on grid .. Set the loan to view , change loan details on top of the page and remove error
        //Designed: Irfan Mam
        //User story: DFP-468
        //Developed: Irfan MAM
        //Date created: 6/24/2016

        // set the loan id of selected row if one row click
        $(document).on('click', '.ui-row-ltr', function () {


            var myGrid = jQuery("#grid"); // select grid
            var id = myGrid.jqGrid('getGridParam', 'selrow'); // take the selected loan from that grid

            var currentLoan = $("#loanId").val(); // take current loan selected

            // if user change the loan
            if (currentLoan != id) {
                // set the loan
                $("#loanId").val(id);


                // change the loan detail bar on top the page
                LoanNumber = myGrid.jqGrid('getCell', id, 'LoanNumber'); // take loan number from selected loan
                PatBranchName = myGrid.jqGrid('getCell', id, 'PatBranchName');   // take Parner branch name from selected loan
                PatBranchAddress1 = myGrid.jqGrid('getCell', id, 'PatBranchAddress1'); // take Parner branch address1 from selected loan
                PatBranchAddress2 = myGrid.jqGrid('getCell', id, 'PatBranchAddress2');  // take Parner branch address2 from selected loan
                City = myGrid.jqGrid('getCell', id, 'PatCity');  // take Parner city from selected loan

                PatBranchAddress = PatBranchAddress1 + (PatBranchAddress2 != "" ? ', ' + PatBranchAddress2 : '') + (City != "" ? ', ' + City : ''); // combine address using name, address1, address2 and city

                // set the address on the bar
                $('#Pataddress').html('<span class="parbranchname">' + PatBranchName + '</span> -  <span class="parbarnchaddress">' + PatBranchAddress + '</span>  ');
                // set the loan number on the bar
                $('.loanumber').html('<strong>Loan Number : &nbsp; </strong> ' + LoanNumber);

                @if(ViewBag.RoleId == 3 || ViewBag.RoleId == 4)
                {
                    <text>
                //  change buttons according to the loan
                changeButtons($("#loanId").val());
                </text>
                }
            }


            // remove error message on top after select the gid
            if ($('.centered h5 span').text() == 'Please select a loan') {
                $('.centered h5 span').text("");
            }


        });

        // reset the loan id to empty if refresh button click
        $('.ui-icon-refresh').parent().click(function () {

            $("#loanId").val('');
            // set the address on the bar
            $('#Pataddress').html('');
            // set the loan number on the bar
            $('.loanumber').html('<strong>Loan Number : &nbsp; </strong> ');

        });

        // reset the loan id to empty if search button click and reset selection on the grid
        $('.ui-icon-search, .ui-jqgrid-sortable').parent().click(function () {

            $("#loanId").val('');
            // set the address on the bar
            $('#Pataddress').html('');
            // set the loan number on the bar
            $('.loanumber').html('<strong>Loan Number : &nbsp; </strong> ');

            jQuery("#grid").jqGrid('resetSelection');

        });





        DefaultLoanID = $("#loanId").val();  // set first selected loanId
        $('.icon-home3').removeAttr('onclick'); // remove on click dashboard action


        $('.icon-home3').click(function () {

            /// if user change the loan on dashboard
            if ($("#loanId").val() != DefaultLoanID) {

                if (DefaultLoanID == "") {
                    if ($("#loanId").val() != undefined && $("#loanId").val() != "") {

                        window.location.href = '/UserManagement/setLoanCode?loanCode=' + jQuery("#grid").jqGrid('getCell', $("#loanId").val(), 'LoanCode');
                    } else {
                        window.location.href = '/UserManagement/UserDetails';
                    }

                } else {
                    DefaultLoanCode = jQuery("#grid").jqGrid('getCell', DefaultLoanID, 'LoanNumber');
                    var currentLoancode = jQuery("#grid").jqGrid('getCell', $("#loanId").val(), 'LoanNumber');
                    $('#loanChangedtext').text('You were previously working on loan ' + DefaultLoanCode + ' but have changed to loan ' + currentLoancode + ' while on the reports page. Would you like to work with loan ' + currentLoancode + ' now?'); //
                    $('#loanChangedspan').text('Press Yes to work with loan ' + currentLoancode + ' or press No to work with loan ' + DefaultLoanCode + '.');
                    var docHeight = $(document).height(); //grab the height of the page
                    var scrollTop = $(window).scrollTop(); //grab the px value from the top of the page to where you're scrolling
                    $('.overlay-bg').show().css({ 'height': docHeight }); //display your popup background and set height to the page height
                    $('.popup-changed-loan').show().css({ 'top': scrollTop + 20 + 'px' }); //show the appropriate popup and set the content 20px from the window top
                    $('#chanegLoan').attr('onclick', 'window.location.href = "/UserManagement/setLoanCode?loanCode=' + jQuery("#grid").jqGrid('getCell', $("#loanId").val(), 'LoanCode') + '"');

                }



            }
                // if user doesn't change the loan
            else if ($("#loanId").val() != "") {

                // if there is one loan
                @if(ViewBag.loan != null)
                {
                    // if there is one loan and it has right
                    if (Session["oneLoanDashboard"] != null)
                    {
                        <text>
                window.location.href = '/UserManagement/UserDetails';
                </text>
                    }

                    // if there is more loan and one has right
                    else
                    {
                        <text>
                window.location.href = '/UserManagement/setLoanCode?loanCode=@(((List<Account>)ViewBag.loan)[0].LoanCode)';

                </text>
                    }

                }
                else
                {
                    <text>
                window.location.href = '/UserManagement/setLoanCode?loanCode=' + jQuery("#grid").jqGrid('getCell', $("#loanId").val(), 'LoanCode');
                </text>
                }


            }

            else {
                window.location.href = '/UserManagement/UserDetails';
            }


        });

    });


    function changeButtons(loanid) {

        $('.btn-info1').hide();

        var myGrid = jQuery("#grid"); // select grid

        // get user right of that loan

        var userRights = myGrid.jqGrid('getCell', loanid, 'userReportRights'); // get user rights

        if (userRights.indexOf("R01") > -1) {
            $("#btnLotInspection").show();
        }

        if (userRights.indexOf("R02") > -1) {


            $("#btnCurtailmentInvoice").show();
        }

        if (userRights.indexOf("R03") > -1) {

            $("#btnCurtailmentReceipt").show();
        }

        if (userRights.indexOf("R04") > -1) {

            $("#btnTitlesStatus").show();
        }

        if (userRights.indexOf("R05") > -1) {

            $("#btnFullInventory").show();
        }

        if (userRights.indexOf("R06") > -1) {

            $("#btnAdvanceUnit").show();
        }

        if (userRights.indexOf("R07") > -1) {

            $("#btnAdvFeeInv").show();
        }

        if (userRights.indexOf("R08") > -1) {

            $("#btnAdvanceFeeReceipt").show();
        }

        if (userRights.indexOf("R09") > -1) {

            $("#btnLoanFeeInv").show();
        }

        if (userRights.indexOf("R10") > -1) {

            $("#btnMonthlyLoanFeeReceipt").show();
        }

        if (userRights.indexOf("R11") > -1) {

            $("#btnLotInsFeeInv").show();
        }

        if (userRights.indexOf("R12") > -1) {

            $("#btnLotInspectionFeeReceipt").show();
        }

        if (userRights.indexOf("R13") > -1) {

            $("#btnPayOff").show();
        }

        if (userRights.indexOf("R14") > -1) {

            $("#btnTransactionHistory").show();
        }

        if (userRights.indexOf("R15") > -1) {

            $("#btnLoanTerms").show();
        }

        if (userRights.indexOf("R16") > -1) {

            $("#btnDeletedUnits").show();
        }

        if (userRights.indexOf("R19") > -1) {

            $("#btnLoanSummary").show();
        }

        if (userRights.indexOf("R18") > -1) {

            $("#btnFullCurtSummary").show();
        }
        if (userRights.indexOf("R17") > -1) {

            $("#btnIndCurtSummary").show();
        }
    }
    @*capitalize letters when typing*@
    $('#idNumber').keyup(function () {
        $('#idNumber').val(($('#idNumber').val()).toUpperCase());
    });
    @*block invalid characters*@
    $("#idNumber").keypress(function (e) {
        if (e.which != 8 && e.keyCode != 46 && e.keyCode != 9) {
            var ch = e.which;
            if ((ch >= 47 && ch <= 57) || (ch >= 65 && ch <= 90) || (ch >= 97 && ch <= 122)) {
                return 1;
            }

            else {
                e.preventDefault();
            }
        }

    });


    $('.title-help').click(function () {

        $('.help-text h4').html("About this page");
        $('.help-text p').html(" &nbsp;&nbsp; On the reports page you are able to select a report from the list below and gather valuable information on the loan. Please select a specific report to view more details about that report.");

    });
    $('.help-start-date').click(function () {

        $('.help-text h4').html("Start and End date");
        $('.help-text p').html(" &nbsp;&nbsp; Select the date range you would like to view. Any transactions which took place during the selected date range will be displayed in the report.");

    });
    $('.help-branch').click(function () {

        $('.help-text h4').html("Select branch");
        $('.help-text p').html(" &nbsp;&nbsp; Select the branch of your company which you would like to view the summary of.");

    });
    $('.help-idnumber').click(function () {

        $('.help-text h4').html("Search for a unit");
        $('.help-text p').html(" &nbsp;&nbsp; Type in the last 6 characters of the VIN/HIN/Serial Number for the unit you would like to view the curtailment summary of.");

    });
    $('.help-titl-slct').click(function () {

        $('.help-text h4').html("Title Status Selection");
        $('.help-text p').html(" &nbsp;&nbsp; All active units with a title status which matches the selection will be displayed.");

    });
    $('.help-lot-insp').click(function () {

        $('.help-text h4').html("Lot Inspection");
        $('.help-text p').html(" &nbsp;&nbsp; The lot inspection report will display all active units on the loan with the basic details needed to complete a lot inspection.");

    });
    $('.help-curt-inv').click(function () {
        $('.help-text h4').html("Curtailment Invoice");
        $('.help-text p').html("&nbsp;&nbsp;The curtailment invoice will display all curtailments for active units which are due during the date range selected.");
    });
    $('.help-curt-rcpt').click(function () {
        $('.help-text h4').html("Curtailment Receipt");
        $('.help-text p').html("&nbsp;&nbsp;The curtailment receipt will display all curtailments which were paid during the date range selected.");

    });
    $('.help-titl-stat').click(function () {
        $('.help-text h4').html("Title Status");
        $('.help-text p').html("&nbsp;&nbsp;The title status report will display active units with a title status matching the selection made from the drop down menu.");
    });
    $('.help-full-inv').click(function () {
        $('.help-text h4').html("Full Inventry");
        $('.help-text p').html("&nbsp;&nbsp;The full inventory report will display all active units in the loan along with the important details.");
    });
    $('.help-adv-unit').click(function () {
        $('.help-text h4').html("Advance Unit");
        $('.help-text p').html("&nbsp;&nbsp;The advance unit report will display all units which were advanced during the date range specified.");
    });
    $('.help-adv-fee').click(function () {
        $('.help-text h4').html("Advance Fee Invoice");
        $('.help-text p').html("&nbsp;&nbsp;The advance fee invoice will display all advance fees which are due during the date range selected.");
    });
    $('.help-adv-fee-rcpt').click(function () {
        $('.help-text h4').html("Advance Fee Receipt");
        $('.help-text p').html("&nbsp;&nbsp;The advance fee receipt will display all advance fees which were paid during the date range selected.");
    });
    $('.help-mon-fee').click(function () {
        $('.help-text h4').html("Monthly Loan Fee Invoice");
        $('.help-text p').html("&nbsp;&nbsp;The monthly loan fee invoice will display the monthly loan fee amounts which are due for the date range selected.");
    });
    $('.help-mon-fee-rcpt').click(function () {
        $('.help-text h4').html("Monthly Loan Fee Receipt");
        $('.help-text p').html("&nbsp;&nbsp;The monthly loan fee receipt will display the monthly loan fee amounts which were paid during the date range selected.");
    });
    $('.help-lot-fee').click(function () {
        $('.help-text h4').html("Lot Inspection Fee Invoice");
        $('.help-text p').html("&nbsp;&nbsp;The lot inspecion fee invoice will display the lot inspection fee amounts which are due during the date range selected. ");
    });
    $('.help-lot-fee-rcpt').click(function () {
        $('.help-text h4').html("Lot Inspection Fee Receipt");
        $('.help-text p').html("&nbsp;&nbsp;The lot inspection fee receipt will display the lot inspection fee amounts which were paid during the date range selected.");
    });
    $('.help-pay-off').click(function () {
        $('.help-text h4').html("Pay Off");
        $('.help-text p').html("&nbsp;&nbsp;The pay off report will display the details of all units which were paid off during the date range selected.");
    });
    $('.help-trans-his').click(function () {
        $('.help-text h4').html("Transaction History");
        $('.help-text p').html("&nbsp;&nbsp;The transaction history report will display a full list of all transactions which took place for the loan during the date range selected.");
    });
    $('.help-loan-terms').click(function () {
        $('.help-text h4').html("Loan Terms");
        $('.help-text p').html("&nbsp;&nbsp;The loan terms report will display all details of the Terms for the selected loan.");
    });
    $('.help-cmp-smry').click(function () {
        $('.help-text h4').html("Company Summary");
        $('.help-text p').html("&nbsp;&nbsp;The company summary report will display details of active loans for each branch including active units and loan amounts.");
    });
    $('.help-brn-smry').click(function () {
        $('.help-text h4').html("Branch Summary");
        $('.help-text p').html("&nbsp;&nbsp;The branch summary report will display all active loans for the branch with details about the loan including unit numbers and loan amounts.");
    });
    $('.help-del-unit').click(function () {
        $('.help-text h4').html("Deleted Unit");
        $('.help-text p').html("&nbsp;&nbsp;The deleted units report will display all details of any unit which was deleted during the date range selected.");
    });
    $('.help-loan-smry').click(function () {
        $('.help-text h4').html("Loan Summary");
        $('.help-text p').html("&nbsp;&nbsp;The loan summary report will display a summary of all transaction types which took place for the loan during the date range selected.");
    });
    $('.help-full-curt-smry').click(function () {
        $('.help-text h4').html("Full Curtailment Summary");
        $('.help-text p').html("&nbsp;&nbsp;The full curtailment summary report will display the total number of curtailments paid and the paid amount as well as the balance due for each active unit on the selected loan.");
    });
    $('.help-ind-curt-smry').click(function () {
        $('.help-text h4').html("Individual Curtailment Summary");
        $('.help-text p').html("&nbsp;&nbsp;The individual curtailment summary report will display each individual curtailment payment for the selected unit.");
    });
</script>
