@{

    Layout = null;
}

@using System.Threading;
@using System.Globalization;

<link href="~/Content/overlaypopup.css" rel="stylesheet" />


<div class="top-bar">
    <div class="profile-elements ">

        <img alt="image" class="img-circle" src="~/Images/profile_small.jpg"><br>





        <span class="block"><strong>@ViewBag.Username</strong></span>
        <span> - </span>
        <span><strong>@ViewBag.Branch</strong></span>









    </div>


    @Html.ActionLink("Sign out", "UserLogin", "Login", null, new { @class = "btn btn-info show-logout-popup", @data_showpopup = "1" })

    @*@Ajax.ActionLink("Add Advance", "Selectloan", "UserManagement", new { type = "tyuirede" }, new AjaxOptions { OnFailure = "handleError", HttpMethod = "GET", InsertionMode = InsertionMode.Replace, UpdateTargetId = "selcet-panel", LoadingElementId = "loadingSpan" }, new { @class = "btn btn-info show-popup", @id = "lkuni", @data_showpopup = "1" })*@

    <h2>@ViewBag.Title</h2>




</div>

<div class="centered" >
    <h5><span class="field-validation-error label label-danger" style="left:49%"></span></h5>
    
</div>

<div class="centered1">
    <h5><span class="label label-success" style="left:48%"></span></h5>

</div>

<div class="info">
    @if(ViewBag.Title != "Pay Curtailments") { 

    <div class="address">
        <span style="float:left;width:450px"><strong>@ViewBag.loanCompanyType</strong> : @ViewBag.loanBranchAddress </span>




        <span style="text-align:center"><strong>Loan Number</strong> : @ViewBag.LoanNumber </span>



        @{
            Thread.CurrentThread.CurrentCulture = new CultureInfo("en-US");

            var timezone = TimeZoneInfo.FindSystemTimeZoneById("Central America Standard Time");
            var dateTime = TimeZoneInfo.ConvertTime(DateTime.Now, timezone);

        }

        <span style="float:right;padding-right:18px;"><strong>Date</strong> :  @dateTime.ToString("d")</span>


    </div>

            }
            else
            {
                <div class="address">
                    <span style="float:left;width:36%"><strong>@ViewBag.loanCompanyType</strong> : @ViewBag.loanBranchAddress </span>




                    <span style="text-align:center"><strong>Loan Number</strong> : @ViewBag.LoanNumber </span>



                    @{
                        Thread.CurrentThread.CurrentCulture = new CultureInfo("en-US");

                        var timezone = TimeZoneInfo.FindSystemTimeZoneById("Central America Standard Time");
                        var dateTime = TimeZoneInfo.ConvertTime(DateTime.Now, timezone);

                    }

                    <span style="float:right;padding-right:20px;"><strong>CurtDueDate : @ViewBag.CurtailmentDueDate </strong> </span>
                    <span style="float:right;padding-right:17%;"><strong>Date</strong> :  @dateTime.ToString("d")</span>


                </div>

                        }
</div>




<script>

    $(document).ready(function () {

        @if (ViewBag.Msg == "Success")
        {
           <text> $('.centered1 span').text('Successfully Updated');</text>
        } else if (ViewBag.Msg == "Error") {

            <text> $('.centered span').text('Error in page');</text>
        }else if (ViewBag.Msg == "Advance Error") {

            <text> $('.centered span').text('Invalid amount found for advance');</text>
        }else if (ViewBag.Msg == "PayOffSuccess")
        {
           <text> $('.centered1 span').text('PayOff Completed');</text>
        } else if (ViewBag.Msg == "PayOffError") {

            <text> $('.centered span').text('PayOff Failed');</text>
        }

        // show popup when you click on the link

        $(document).on('click', 'input', function () {
            $('.centered1 span').text('');
        });

        $('select').change(function () {
            $('.centered1 span').text('');
        });


        //$(document).on("click", function () {
        //    alert("click bound to document listening for #test-element");
        //    middleSpanCheck();
        //});



        $(document).on('click' ,'.show-logout-popup' ,function (event) {





            @if(ViewBag.Title == "Advance Unit") {
                 <text>if ($('#iVin').val() != "") { event.preventDefault(); var selectedPopup = $(this).data('showpopup'); showPopup(selectedPopup); }</text>

            }else if(ViewBag.Title == "Add Unit Page") {

                                <text>if (($('#txtCost').val() != "" && $('#txtCost').val() != 0) || ($('#txtAdvanceAmount').val() != "" && $('#txtAdvanceAmount').val() != 0) || $("#rdYes").is(":checked") == true || $("#rdNo").is(":checked") == true || $("#rdAdvanceYes").is(":checked") == true || $("#rdAdvanceNo").is(":checked") == true)
            {
                event.preventDefault(); var selectedPopup = $(this).data('showpopup'); showPopup(selectedPopup);
            }</text>
            }
            else if (ViewBag.Title == "Title Status Update")
            {
                 <text>if (($('#identificationNumber').val() != "" && $('#identificationNumber').val() != null) || ($('#unitYear').val() != "" && $('#unitYear').val() != 0) || ($('#unitMake').val() != "" && $('#unitMake').val() != null) || ($('#unitModel').val() != "" && $('#unitModel').val() != null) || ($('#unitStatus').val() != "" && $('#unitStatus').val() != null) || ($('#titleStatus').val() != "" && $('#titleStatus').val() != null) || $("#notReceived").is(":checked") == true || $("#received").is(":checked") == true || $("#returnDealer").is(":checked") == true || $("#sentBank").is(":checked") == true)
            {
                event.preventDefault(); var selectedPopup = $(this).data('showpopup'); showPopup(selectedPopup);
            }</text>
            }

            else if (ViewBag.Title == "Pay Curtailments")
            {
                <text>if ($('#identificationNumber').val() != "" || $('#checkableGrid tbody tr td').children(':input[type="checkbox"]:checked').length > 0 )
                {
                    event.preventDefault(); var selectedPopup = $(this).data('showpopup'); showPopup(selectedPopup);
                }</text>
            }

            else if (ViewBag.Title == "Pay Off")
            {
                <text>if ($('#payDate2').val() != "" || $('#checkableGrid tbody tr td').children(':input[type="checkbox"]:checked').length > 0)
                {
                    event.preventDefault(); var selectedPopup = $(this).data('showpopup'); showPopup(selectedPopup);
                }</text>
            }

        });




        // function to show our popups
        function showPopup(whichpopup) {
            var docHeight = $(document).height(); //grab the height of the page
            var scrollTop = $(window).scrollTop(); //grab the px value from the top of the page to where you're scrolling
            $('.overlay-bg').show().css({ 'height': docHeight }); //display your popup background and set height to the page height
            $('.popup' + whichpopup).show().css({ 'top': scrollTop + 20 + 'px' }); //show the appropriate popup and set the content 20px from the window top
        }

        // function to close our popups
        function closePopup() {
            $('.overlay-bg, .overlay-content').hide(); //hide the overlay
        }

        // timer if we want to show a popup after a few seconds.
        //get rid of this if you don't want a popup to show up automatically
        // setTimeout(function() {
        // Show popup3 after 2 seconds
        //    showPopup(3);
        // }, 2000);


        // show popup when you click on the link
        $('.show-popup').click(function (event) {
            //event.preventDefault(); // disable normal link function so that it doesn't refresh the page
            var selectedPopup = $(this).data('showpopup'); //get the corresponding popup to show

            showPopup(selectedPopup); //we'll pass in the popup number to our showPopup() function to show which popup we want
        });

        // hide popup when user clicks on close button or if user clicks anywhere outside the container
        $('.close-btn, .overlay-bg').click(function () {
            closePopup();
        });

        // hide the popup when user presses the esc key
        $(document).keyup(function (e) {
            if (e.keyCode == 27) { // if user presses esc key
                closePopup();
            }
        });

        $(document).on("blur","input",function() {
            var isError = false;
            if ($(this).next('span').children('span').text().length > 0) {
               $('.centered span').text('Error');
                isError = true;
            }
            //else if ($(this).siblings().next('span').children('span').length === 0) {

            //    $('.centered span').text('');
            //}


            $.each($('input').next('span'), function (i, obj) {
                if ($(obj).children('span').length > 0) {
                    isError = true;
                }
            });


            @if(ViewBag.Title == "Advance Unit") {
                <text>
            if (isError == false) {
            if ($(this).next('#tagscloud').children('span').text() != "") {
                $('.centered span').text('Error');
                isError = true;
            } else {
                isError = false;
            }
            }</text>

            }else if(ViewBag.Title == "Add Unit Page") {
                 <text>
            if (isError === false) {
            if ($(this).next('span').next('#tagscloud').children('span').text() != "" || $(this).next('span').next('#tagscloudAdvance').children('span').text()) {
                $('.centered span').text('Error');
                isError = true;
            } else {
                isError = false;
            }
            }
            </text>
            }

            else if(ViewBag.Title == "Pay Curtailments") {
                <text>
           if (isError === false) {
               if ($('#errorPayDate').text() != "" || $('#errorCurtAmount').text() != "" || $('#errorCurtPayDate').text() != "" ) {
                   $('.centered span').text('Error');
                   isError = true;
               } else {
                   isError = false;
               }
           }
                </text>
            }




            $('.centered span').text('Error');
            if (isError === false)
                $('.centered span').text('');
        });
    });


</script>




<div class="overlay-bg">
</div>
<div class="overlay-content popup1" style="width:auto;text-align:center;left: 60%;">


    <h3>Logout</h3>

    <span class="text-warning"> Are you sure you want to logout?</span><br />
    <span> Press OK to continue, or Cancel to stay on the current page.</span><br />
    <br />
    @Html.ActionLink("OK", "UserLogin", "Login", null, new { @class = "btn btn-info", style = "width: 70px;margin-right: 20px;" })
    <button class="close-btn btn btn-info">Cancel</button>



</div>

