@model BankLoanSystem.Models.User

<style>
#rights > input{
 float:unset;
 margin-right:10px;

 width:17px;
 height:17px;
}

#rights{
text-align:left;
font-size:14px;
font-weight:normal;
color:#545454;
}
#DivRptRights{
text-align:left;
font-size:14px;
font-weight:normal;
color:#545454;
}
#DivRptRights > input{
 float:unset;
 margin-right:10px;

 width:17px;
 height:17px;
}
</style>
<script src="~/scripts/CommonFunctions.js"></script>
<div id="branchDivLoan">

    <div class="form-group new_form_group">
        <div class="control-label col-sm-2 lable_style">
            <label>Loan </label>
        </div>
        @if (ViewBag.LoanId.Items.Count == 1)
        {
        <div class="col-xs-8 text_field short_text_field">
            @Html.HiddenFor(model => model.LoanId, new { @Value = (int)ViewBag.LoanId.Items[0].LoanId, id = "LoanIdUser" })
            @Html.LabelFor(model => model.LoanId, (string)ViewBag.LoanId.Items[0].LoanNumber, htmlAttributes: new { @class = "form-control text_field_input", id = "RegisteredBranchIdUser", style = "border:none;border-radius:none;-webkit-box-shadow:nonr;box-shadow:none;margin-top: 3px;display: block;float:left;" })
        </div>
        }
        else {
        <div class="col-xs-8 text_field short_text_field">
            @Html.DropDownListFor(model => model.LoanId, null, "--Select Loan--", htmlAttributes: new { @class = "form-control", id = "LoanIdUser2", @onchange = "javascript:CheckLoanTitle(this.value);" })
        </div>
        <div id="loanIdMessage" class="text-danger" style="margin-top:35px;margin-left:-155px;"><span></span></div>
        }
        <div class="err_msg_box">
            <p class="err_msg new_err_msg">@Html.ValidationMessageFor(model => model.LoanId, "", new { @class = "text-danger" })</p>
        </div>
        
    </div>

</div>



<div id="rightDiv">
    <div class="form-group new_form_group">
        <div class="control-label col-sm-2 lable_style">
            <label>Select Loan Rights</label>
        </div>
        <div class="col-xs-8 ">
            @if (Model.UserRightsList.Count > 0)
            {
            <div class="col-sm-7">
                
                <div id="rights">
                    @Html.CheckBox("selectAll", new { @class = "All", @id = "CheckAll" })
                    @Html.Label("All")
                    <br />
                    @for (var i = 0; i < Model.UserRightsList.Count; i++)
                    {
                        <div id="rights">
                            @Html.HiddenFor(x => x.UserRightsList[i].rightId)
                            @Html.CheckBoxFor(x => x.UserRightsList[i].active, new { @class = "All", @id = i + 1 })
                            @Html.Label(Model.UserRightsList[i].description)
                            @if (i == 6)
                            {
                                if (Model.ReportRightsList!=null && Model.ReportRightsList.Count > 0)
                                {
                                <div id="DivRptRights" hidden>
                                    @for (var j = 0; j < Model.ReportRightsList.Count; j++)
                                    {
                                        @Html.HiddenFor(x => x.ReportRightsList[j].rightId)
                                        @Html.CheckBoxFor(x => x.ReportRightsList[j].active, new { @class = "All", @id = "rpt" + (j + 1) })
                                        @Html.Label(Model.ReportRightsList[j].name)
                                        <br />
                                    }
                                </div>
                                    }
                                }
                        </div>

                    }
                </div>
                <div id="checkBoxMessage" class="text-danger"><span></span></div>
            </div>
            }
        </div>
        </div>
        
    </div>


<script type="text/javascript">


    var title = 0;
    var hasFee = 0;
    @if(ViewBag.LoanId!=null && ViewBag.LoanId.Items.Count == 1)
    {

        <text>var loanId = @ViewBag.LoanId.Items[0].LoanId;</text>
         
    <text> CheckLoanTitle(loanId);</text>
    };
    function CheckLoanTitle(loanId){

        var model = @Html.Raw(Json.Encode(Model));
        var len = model.BranchList.length;
        var count =0;
        for (var j = 0 ; j < model.BranchList.length; j++){
            if(model.BranchList[j].LoanId==loanId && model.BranchList[j].IsTitleTrack==0 && model.BranchList[j].HasFee==0){
                title = 0;
                hasFee = 0;
                $('#6').hide();
                $('[for="Pay_Fees"]').hide();
                $('#4').hide();
                $('[for="Update_Title_Status"]').hide();

            }
            else if(model.BranchList[j].LoanId==loanId && model.BranchList[j].IsTitleTrack==0 && model.BranchList[j].HasFee==1){
                title = 0;
                hasFee = 1;
                $('#6').show();
                $('[for="Pay_Fees"]').show();
                $('#4').hide();
                $('[for="Update_Title_Status"]').hide();

            }
            else if(model.BranchList[j].LoanId==loanId && model.BranchList[j].IsTitleTrack==1 && model.BranchList[j].HasFee==1){
                title = 1;
                hasFee = 1;
                $('#6').show();
                $('[for="Pay_Fees"]').show();
                $('#4').show();
                $('[for="Update_Title_Status"]').show();

            }
            else if(model.BranchList[j].LoanId==loanId && model.BranchList[j].IsTitleTrack==1 && model.BranchList[j].HasFee==0){
                title = 1;
                hasFee = 0;
                $('#6').hide();
                $('[for="Pay_Fees"]').hide();
                $('#4').show();
                $('[for="Update_Title_Status"]').show();

            }
            //else{
            //    title = 1;
            //    $('#4').show();
            //    $('[for="Update_Title_Status"]').show();
            //}
        }



    };
    
    $(function () {
        $('#CheckAll').on('change', function () {
            $('#checkBoxMessage span').text("");
            if ($(this).is(':checked')) {
                //alert('checked');
                $('#checkBoxMessage span').text("");
                $('.All').prop('checked', true);

            }
            else {
                //alert('unchecked');
                $('.All').prop('checked', false);
            }
        });
        //$('.All').on('change', function () {
        //    $('#checkBoxMessage span').text("");

        //});
    });
    if(@ViewBag.LoanId.Items.Count==1){
        var loan = $('#LoanIdUser').val();
        SendParaTo(loan);
    }

    $('#LoanIdUser2').change(function () {
        $('#loanIdMessage span').text("");
        $('#selectAll').prop('checked', false);
        $('.All').prop('checked', false);

    });
    $(function () {
        $('.All').on('change', function () {
            $('#checkBoxMessage span').text("");
            checkAll();
        });
    });
    function checkAll(){
        var model = @Html.Raw(Json.Encode(Model));
        var len = model.UserRightsList.length;
        var count =0;
        for (var j = 0 ; j < model.UserRightsList.length; j++){
            var str = '#'+(j+1);
            if ($(str).is(':checked')) {
                //alert('checked');
                count++;
            }
        }
        if( title != 1 && hasFee === 1 && count === (len-1)){
            $('#CheckAll').prop('checked', true);
        }
        else if( title == 1 && hasFee != 1 && count === (len-1)){
            $('#CheckAll').prop('checked', true);
        }
        else if( title != 1 && hasFee != 1 && count === (len-2)){
            $('#CheckAll').prop('checked', true);
        }
        else if( count === len){
            $('#CheckAll').prop('checked', true);
        }
        else{
            $('#CheckAll').prop('checked', false);
        }
        $('#successSpn span').text("");
        $('#errSpn span').text("");
    };
    function modcheck(){
        var model = @Html.Raw(Json.Encode(Model));
        //console.log(model);
        //alert('f');
        var arr = new Array();
        for(var j=0,k=0; j< model.UserRightsList.length ;j++){
            var ids = '#'+ j.toString();
            if($(ids).is(':checked')){

                arr[k] = model.UserRightsList[j].rightId;
                k++;
            }
        }
        return arr;
        //console.log(arr);
    }

    $('#7').change(function(){
        if($(this).is(":checked")) {
            //alert('checked');
            $('#DivRptRights').show();
           
        }
        else{
            $('#DivRptRights').hide();
        }
    });
    
    </script>




