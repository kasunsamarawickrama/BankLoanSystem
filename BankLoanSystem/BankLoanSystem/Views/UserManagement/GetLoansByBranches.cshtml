@model BankLoanSystem.Models.User
<script src="~/Scripts/jquery-1.10.2.min.js"></script>
<script src="~/Scripts/jquery.validate.min.js?version=@((new Random()).Next(1,10000))."></script>
<script src="~/Scripts/jquery.validate.unobtrusive.min.js?version=@((new Random()).Next(1,10000))."></script>

<script src="~/scripts/jquery.unobtrusive-ajax.min.js"></script>
<style>
#rights > input{
 float:unset;
 margin-right:10px;

 width:17px;
 height:17px;
}

#rights{
text-align:left;
font-size:14px;
font-weight:normal;
color:#545454;
width:400%;
}
#DivRptRights{
text-align:left;
font-size:14px;
font-weight:normal;
color:#545454;
margin-left:1%;
}
#DivRptRights > input{
 float:unset;
 margin-right:10px;

 width:17px;
 height:17px;
}
</style>
<script src="~/scripts/jquery-1.10.2.min.js"></script>

<script src="~/scripts/CommonFunctions.js"></script>
<div id="branchDivLoan">

    <div class="form-group new_form_group">
        <div class="control-label col-sm-2 lable_style">
            <label>Loan </label>
        </div>
        @if (ViewBag.LoanId.Items.Count == 1)
        {
        <div class="col-xs-8 text_field short_text_field">
            @Html.HiddenFor(model => model.LoanId, new { @Value = (int)ViewBag.LoanId.Items[0].LoanId, id = "LoanIdUser" })
            @Html.LabelFor(model => model.LoanId, (string)ViewBag.LoanId.Items[0].LoanNumber, htmlAttributes: new { @class = "form-control text_field_input", id = "RegisteredBranchIdUser", style = "border:none;border-radius:none;-webkit-box-shadow:nonr;box-shadow:none;margin-top: 3px;display: block;float:left;" })
        </div>
        }
        else {
        <div class="col-xs-8 text_field short_text_field">
            @Html.DropDownListFor(model => model.LoanId, null, "--Select Loan--", htmlAttributes: new { @class = "form-control", id = "LoanIdUser2", @onchange = "javascript:CheckLoanTitle(this.value);" })
        </div>
        <div id="loanIdMessage" class="text-danger" style="margin-top:35px;margin-left:-155px;"><span></span></div>
        }
        <div class="err_msg_box">
            <p class="err_msg new_err_msg">@Html.ValidationMessageFor(model => model.LoanId, "", new { @class = "text-danger" })</p>
        </div>
        
    </div>

</div>



<div id="rightDiv">
    <div class="form-group new_form_group">
        <div class="control-label col-sm-2 lable_style">
            <label>Select Loan Rights</label>
        </div>
        <div class="col-xs-8 ">
            @if (Model.UserRightsList.Count > 0)
            {
            <div class="col-sm-7">
                
                <div id="rights">
                    @Html.CheckBox("selectAll", new { @class = "All", @id = "CheckAll" })
                    @Html.Label("All")
                    <br />
                    @for (var i = 0; i < Model.UserRightsList.Count; i++)
                    {
                        <div id="rights">
                            @Html.HiddenFor(x => x.UserRightsList[i].rightId)
                            @Html.CheckBoxFor(x => x.UserRightsList[i].active, new { @class = "All", @id = i + 1 })
                            @Html.Label(Model.UserRightsList[i].description)
                            @if (i == 6)
                            {
                                if (Model.ReportRightsList!=null && Model.ReportRightsList.Count > 0)
                                {
                                <div id="DivRptRights" hidden>
                                    @Html.CheckBox("selectAll", new { @class = "All2", @id = "CheckAll2" })
                                    @Html.Label("All")
                                    <br />
                                    @for (var j = 0; j < Model.ReportRightsList.Count; j++)
                                    {
                                        @Html.HiddenFor(x => x.ReportRightsList[j].rightId)
                                        @Html.CheckBoxFor(x => x.ReportRightsList[j].active, new { @class = "All2", @id = "rpt" + (j + 1) })
                                        @Html.Label(Model.ReportRightsList[j].name)
                                        <a onclick="ViewDetails(@i)" id="Description">View Details</a>
                                        <br />
                                    }
                                </div>
                                    }
                                }
                        </div>

                    }
                </div>
                <div id="checkBoxMessage" class="text-danger"><span></span></div>
            </div>
            }
        </div>
        </div>
        
    </div>


<script type="text/javascript">


    var title = 0;
    var hasFee = 0;
    @if(ViewBag.LoanId!=null && ViewBag.LoanId.Items.Count == 1)
    {

        <text>var loanId = @ViewBag.LoanId.Items[0].LoanId;</text>
         
    <text> CheckLoanTitle(loanId);</text>
    };
    function CheckLoanTitle(loanId){

        var model = @Html.Raw(Json.Encode(Model));
        var len = model.BranchList.length;
        var count =0;
        for (var j = 0 ; j < model.BranchList.length; j++){
            if(model.BranchList[j].LoanId==loanId && model.BranchList[j].IsTitleTrack==0 && model.BranchList[j].HasFee==0){
                title = 0;
                hasFee = 0;
                $('#6').hide();
                $('[for="Pay_Fees"]').hide();
                $('#4').hide();
                $('[for="Update_Title_Status"]').hide();

            }
            else if(model.BranchList[j].LoanId==loanId && model.BranchList[j].IsTitleTrack==0 && model.BranchList[j].HasFee==1){
                title = 0;
                hasFee = 1;
                $('#6').show();
                $('[for="Pay_Fees"]').show();
                $('#4').hide();
                $('[for="Update_Title_Status"]').hide();

            }
            else if(model.BranchList[j].LoanId==loanId && model.BranchList[j].IsTitleTrack==1 && model.BranchList[j].HasFee==1){
                title = 1;
                hasFee = 1;
                $('#6').show();
                $('[for="Pay_Fees"]').show();
                $('#4').show();
                $('[for="Update_Title_Status"]').show();

            }
            else if(model.BranchList[j].LoanId==loanId && model.BranchList[j].IsTitleTrack==1 && model.BranchList[j].HasFee==0){
                title = 1;
                hasFee = 0;
                $('#6').hide();
                $('[for="Pay_Fees"]').hide();
                $('#4').show();
                $('[for="Update_Title_Status"]').show();

            }
            //else{
            //    title = 1;
            //    $('#4').show();
            //    $('[for="Update_Title_Status"]').show();
            //}
        }



    };
    
    $(function () {
        $('#CheckAll').on('change', function () {
            $('#checkBoxMessage span').text("");
            if ($(this).is(':checked')) {
                //alert('checked');
                $('#checkBoxMessage span').text("");
                $('.All').prop('checked', true);
                $('#DivRptRights').show();

            }
            else {
                //alert('unchecked');
                $('.All').prop('checked', false);
                $('#DivRptRights').hide();
            }
        });
        
    });
    //for report rights
    $(function () {
        $('#CheckAll2').on('change', function () {
            $('#checkBoxMessage span').text("");
            if ($(this).is(':checked')) {
                //alert('checked');
                $('#checkBoxMessage span').text("");
                $('.All2').prop('checked', true);

            }
            else {
                //alert('unchecked');
                $('.All2').prop('checked', false);
            }
        });
        //$('.All').on('change', function () {
        //    $('#checkBoxMessage span').text("");

        //});
    });
    if(@ViewBag.LoanId.Items.Count==1){
        var loan = $('#LoanIdUser').val();
        SendParaTo(loan);
    }

    $('#LoanIdUser2').change(function () {
        $('#loanIdMessage span').text("");
        $('#selectAll').prop('checked', false);
        $('.All').prop('checked', false);
        $('#CheckAll2').prop('checked', false);
        $('.All2').prop('checked', false);
        $('#DivRptRights').hide();
    });
    $(function () {
        $('.All').on('change', function () {
            $('#checkBoxMessage span').text("");
            checkAll();
        });
    });
    //report rights section
    $(function () {
        $('.All2').on('change', function () {
            $('#checkBoxMessage span').text("");
            checkAll2();
        });
    });
    function checkAll(){
        var model = @Html.Raw(Json.Encode(Model));
        var len = model.UserRightsList.length;
        var count =0;
        for (var j = 0 ; j < model.UserRightsList.length; j++){
            var str = '#'+(j+1);
            if ($(str).is(':checked')) {
                //alert('checked');
                count++;
            }
        }
        if( title != 1 && hasFee === 1 && count === (len-1)){
            $('#CheckAll').prop('checked', true);
        }
        else if( title == 1 && hasFee != 1 && count === (len-1)){
            $('#CheckAll').prop('checked', true);
        }
        else if( title != 1 && hasFee != 1 && count === (len-2)){
            $('#CheckAll').prop('checked', true);
        }
        else if( count === len){
            $('#CheckAll').prop('checked', true);
        }
        else{
            $('#CheckAll').prop('checked', false);
        }
        $('#successSpn span').text("");
        $('#errSpn span').text("");
    };

    function checkAll2(){
        var model = @Html.Raw(Json.Encode(Model));
        var len = model.ReportRightsList.length;
        var count =0;
        for (var j = 0 ; j < model.ReportRightsList.length; j++){
            var str = '#rpt'+(j+1);
            if ($(str).is(':checked')) {
                //alert('checked');
                count++;
            }
        }
       
        if( count === len){
            $('#CheckAll2').prop('checked', true);
        }
        else{
            $('#CheckAll2').prop('checked', false);
        }
        $('#successSpn span').text("");
        $('#errSpn span').text("");
    };
    $('#7').change(function(){
        if($(this).is(":checked")) {
            //alert('checked');
            $('#DivRptRights').show();
           
        }
        else{
            $('#DivRptRights').hide();
        }
    });
    //report popup
    function ViewDetails(rightId){
        //alert(rightId);
        var model = @Html.Raw(Json.Encode(Model));
        $('#PopupDiv').show();
        showPopup('Rpt');
        $('#textForPopup').text(model.ReportRightsList[rightId].name);
        $('#desLbl').text(model.ReportRightsList[rightId].description);

    };
    </script>
<div id="PopupDiv">
    <div class="overlay-bg">
    </div>
    <div class="overlay-content popupRpt" style="width:auto;text-align:center;margin-left: 105px;">
        <h3 id="textForPopup"></h3>
        <div style="padding:10px;">
            <label>Description</label>
        </div>
        <div style="padding:10px;">
            <label id="desLbl"></label>
        </div>
        <div style="padding:10px;">
            <label>Example</label>
        </div>
        <button class="close-btn btn btn-info" style="margin-left: 700px;">Close</button>
    </div>

</div>

<script>

    // function to show our popups
    function showPopup(whichpopup) {
        var docHeight = $(document).height(); //grab the height of the page
        var scrollTop = $(window).scrollTop(); //grab the px value from the top of the page to where you're scrolling
        $('.overlay-bg').show().css({ 'height': docHeight }); //display your popup background and set height to the page height
        $('.popup' + whichpopup).show().css({ 'top': scrollTop + 20 + 'px' }); //show the appropriate popup and set the content 20px from the window top
    }

    // function to close our popups
    function closePopup() {
        $('.overlay-bg, .overlay-content').hide(); //hide the overlay
    }

    // timer if we want to show a popup after a few seconds.
    //get rid of this if you don't want a popup to show up automatically
    // setTimeout(function() {
    // Show popup3 after 2 seconds
    //    showPopup(3);
    // }, 2000);


    // show popup when you click on the link
    $('.show-popup').click(function (event) {
        //event.preventDefault(); // disable normal link function so that it doesn't refresh the page
        var selectedPopup = $(this).data('showpopup'); //get the corresponding popup to show

        showPopup(selectedPopup); //we'll pass in the popup number to our showPopup() function to show which popup we want
    });

    // hide popup when user clicks on close button or if user clicks anywhere outside the container
    $('.close-btn, .overlay-bg').click(function () {
        closePopup();
    });

    // hide the popup when user presses the esc key
    $(document).keyup(function (e) {
        if (e.keyCode == 27) { // if user presses esc key
            closePopup();
        }
    });
</script>



