@model BankLoanSystem.Models.User
<script src="~/Scripts/jquery-1.10.2.min.js"></script>
<script src="~/Scripts/jquery.validate.min.js?version=@((new Random()).Next(1,10000))."></script>
<script src="~/Scripts/jquery.validate.unobtrusive.min.js?version=@((new Random()).Next(1,10000))."></script>

<script src="~/scripts/jquery.unobtrusive-ajax.min.js"></script>
<style>
#rights > input{
 float:unset;
 margin-right:10px;

 width:17px;
 height:17px;
}

#rights{
text-align:left;
font-size:14px;
font-weight:normal;
color:#545454;
width:400%;
}
#DivRptRights{
text-align:left;
font-size:14px;
font-weight:normal;
color:#545454;
margin-left:1%;
}
#DivRptRights > input{
 float:unset;
 margin-right:10px;

 width:17px;
 height:17px;
}
</style>
<script src="~/scripts/jquery-1.10.2.min.js"></script>

<script src="~/scripts/CommonFunctions.js"></script>
<div id="branchDivLoan">

    <div class="form-group new_form_group">
        <div class="control-label col-sm-2 lable_style">
            <label>Loan </label>
        </div>
        @if (ViewBag.LoanId.Items.Count == 1)
        {
        <div class="col-xs-8 text_field short_text_field">
            @Html.HiddenFor(model => model.LoanId, new { @Value = (int)ViewBag.LoanId.Items[0].LoanId, id = "LoanIdUser" })
            @Html.LabelFor(model => model.LoanId, (string)ViewBag.LoanId.Items[0].LoanNumber, htmlAttributes: new { @class = "form-control text_field_input", id = "RegisteredBranchIdUser", style = "border:none;border-radius:none;-webkit-box-shadow:nonr;box-shadow:none;margin-top: 3px;display: block;float:left;" })
        </div>
        }
        else {
        <div class="col-xs-8 text_field short_text_field">
            @Html.DropDownListFor(model => model.LoanId, null, "--Select Loan--", htmlAttributes: new { @class = "form-control", id = "LoanIdUser2", @onchange = "javascript:CheckLoanTitle(this.value);" })
        </div>
        <div id="loanIdMessage" class="text-danger" style="margin-top:35px;margin-left:-155px;"><span></span></div>
        }
        <div class="err_msg_box">
            <p class="err_msg new_err_msg">@Html.ValidationMessageFor(model => model.LoanId, "", new { @class = "text-danger" })</p>
        </div>
        
    </div>

</div>



<div id="rightDiv">
    <div class="form-group new_form_group">
        <div class="control-label col-sm-2 lable_style">
            <label>Select Loan Rights</label>
        </div>
        <div class="col-xs-8 ">
            @if (Model.UserRightsList.Count > 0)
            {
            <div class="col-sm-7">
                
                <div id="rights">
                    @Html.CheckBox("selectAll", new { @class = "All", @id = "CheckAll" })
                    @Html.Label("All")
                    <br />
                    @for (var i = 0; i < Model.UserRightsList.Count; i++)
                    {
                        <div id="rights">
                            @Html.HiddenFor(x => x.UserRightsList[i].rightId)
                            @Html.CheckBoxFor(x => x.UserRightsList[i].active, new { @class = "All", @id = i + 1 })
                            @Html.Label(Model.UserRightsList[i].description)
                            @if (i == 6)
                            {
                                if (Model.ReportRightsList!=null && Model.ReportRightsList.Count > 0)
                                {
                                <div id="DivRptRights" hidden>
                                    @Html.CheckBox("selectAll2", new { @class = "CBAll2", @id = "CheckAll2" })
                                    @Html.Label("All")
                                    <br />
                                    @for (var j = 0; j < Model.ReportRightsList.Count; j++)
                                    {
                                        var xx = "Desc" + (Model.ReportRightsList[j].rightId).ToString();
                                        var xy = "Br_" + (Model.ReportRightsList[j].rightId).ToString();
                                        @Html.HiddenFor(x => x.ReportRightsList[j].rightId)
                                        @Html.CheckBoxFor(x => x.ReportRightsList[j].active, new { @class = "All2", @id = Model.ReportRightsList[j].rightId })
                                        @Html.Label(Model.ReportRightsList[j].name)
                                        <a onclick="ViewDetails(@i)" id="@xx">View Details</a>
                                        <br id="@xy" />
                                    }
                                </div>
                                    }
                                }
                        </div>

                    }
                </div>
                <div id="checkBoxMessage" class="text-danger"><span></span></div>
            </div>
            }
        </div>
        </div>
        
    </div>


<script type="text/javascript">


    var title = 0;
    var hasFee = 0;
    var advanceFee = 0;
    var monthlyFee = 0;
    var lotFee = 0;
    @if(ViewBag.LoanId!=null && ViewBag.LoanId.Items.Count == 1)
    {

        <text>var loanId = @ViewBag.LoanId.Items[0].LoanId;</text>

    <text> CheckLoanTitle(loanId);</text>
    };
    function CheckLoanTitle(loanId){

        var model = @Html.Raw(Json.Encode(Model));
        var len = model.BranchList.length;
        var count =0;
        for (var j = 0 ; j < model.BranchList.length; j++){
            if(model.BranchList[j].LoanId==loanId && model.BranchList[j].IsTitleTrack==0 && model.BranchList[j].HasFee==0){
                title = 0;
                hasFee = 0;
                $('#6').hide();
                $('[for="Pay_Fees"]').hide();
                $('#4').hide();
                $('[for="Update_Title_Status"]').hide();

            }
            else if(model.BranchList[j].LoanId==loanId && model.BranchList[j].IsTitleTrack==0 && model.BranchList[j].HasFee==1){
                title = 0;
                hasFee = 1;
                $('#6').show();
                $('[for="Pay_Fees"]').show();
                $('#4').hide();
                $('[for="Update_Title_Status"]').hide();

            }
            else if(model.BranchList[j].LoanId==loanId && model.BranchList[j].IsTitleTrack==1 && model.BranchList[j].HasFee==1){
                title = 1;
                hasFee = 1;
                $('#6').show();
                $('[for="Pay_Fees"]').show();
                $('#4').show();
                $('[for="Update_Title_Status"]').show();

            }
            else if(model.BranchList[j].LoanId==loanId && model.BranchList[j].IsTitleTrack==1 && model.BranchList[j].HasFee==0){
                title = 1;
                hasFee = 0;
                $('#6').hide();
                $('[for="Pay_Fees"]').hide();
                $('#4').show();
                $('[for="Update_Title_Status"]').show();

            }
            //else{
            //    title = 1;
            //    $('#4').show();
            //    $('[for="Update_Title_Status"]').show();
            //}
        }



    };
    //show report rights according to loan setup details
    function CheckLoanReportRights(loanId2){
        if(loanId2>0){
            
            var model = @Html.Raw(Json.Encode(Model));
            var len = model.BranchList.length;
            var count =0;
            for (var j = 0 ; j < model.BranchList.length; j++){
                if(model.BranchList[j].LoanId==loanId2){
                    if(!model.BranchList[j].IsTitleTrack){
                        title=0;
                        $('#R04').hide();
                        $('[for="Title_Status"]').hide();
                        $('#DescR04').hide();
                        $('#Br_R04').hide();
                    }
                    else{
                        title=1;
                        $('#R04').show();
                        $('[for="Title_Status"]').show();
                        $('#DescR04').show();
                        $('#Br_R04').show();
                    }
                    if(model.BranchList[j].HasAdvanceFee){
                        advanceFee=1;
                        $('#R07').show();
                        $('[for="Advance_Fee_Invoice"]').show();
                        $('#DescR07').show();
                        $('#Br_R07').show();
                        $('#R08').show();
                        $('[for="Advance_Fee_Receipt"]').show();
                        $('#DescR08').show();
                        $('#Br_R08').show();

                    }
                    else{
                        advanceFee=0;
                        $('#R07').hide();
                        $('[for="Advance_Fee_Invoice"]').hide();
                        $('#DescR07').hide();
                        $('#Br_R07').hide();
                        $('#R08').hide();
                        $('[for="Advance_Fee_Receipt"]').hide();
                        $('#DescR08').hide();
                        $('#Br_R08').hide();
                    }
                    if(model.BranchList[j].HasMonthlyFee){
                        monthlyFee=1;
                        $('#R09').show();
                        $('[for="Monthly_Loan_Fee_Invoice"]').show();
                        $('#DescR09').show();
                        $('#Br_R09').show();
                        $('#R10').show();
                        $('[for="Monthly_Loan_Fee_Receipt"]').show();
                        $('#DescR10').show();
                        $('#Br_R10').show();

                    }
                    else{
                        monthlyFee=0;
                        $('#R09').hide();
                        $('[for="Monthly_Loan_Fee_Invoice"]').hide();
                        $('#DescR09').hide();
                        $('#Br_R09').hide();
                        $('#R10').hide();
                        $('[for="Monthly_Loan_Fee_Receipt"]').hide();
                        $('#DescR10').hide();
                        $('#Br_R10').hide();
                    }
                    if(model.BranchList[j].HasLotFee){
                        lotFee=1;
                        $('#R11').show();
                        $('[for="Lot_Inspection_Fee_Invoice"]').show();
                        $('#DescR11').show();
                        $('#Br_R11').show();
                        $('#R12').show();
                        $('[for="Lot_Inspection_Fee_Receipt"]').show();
                        $('#DescR12').show();
                        $('#Br_R12').show();

                    }
                    else{
                        lotFee=0;
                        $('#R11').hide();
                        $('[for="Lot_Inspection_Fee_Invoice"]').hide();
                        $('#DescR11').hide();
                        $('#Br_R11').hide();
                        $('#R12').hide();
                        $('[for="Lot_Inspection_Fee_Receipt"]').hide();
                        $('#DescR12').hide();
                        $('#Br_R12').hide();

                    }
                }
                
                
               
            }

        }




    };
    $(function () {
        $('#CheckAll').on('change', function () {
            $('#checkBoxMessage span').text("");
            if ($(this).is(':checked')) {
                //alert('checked');
                $('#checkBoxMessage span').text("");
                $('.All').prop('checked', true);
                var loanId2 = 0;
            @if(ViewBag.LoanId!=null && ViewBag.LoanId.Items.Count == 1)
                {

                    <text> loanId2 = @ViewBag.LoanId.Items[0].LoanId;</text>

                <text> CheckLoanReportRights(loanId);</text>
                    <text>$('#DivRptRights').show();</text>
                }
                else{

                    <text>loanId2 = $('#LoanIdUser2').val();</text>
                     <text> CheckLoanReportRights(loanId2);</text>
                    <text>$('#DivRptRights').show();</text>

                }
                

            }
            else {
                //alert('unchecked');
                $('.All').prop('checked', false);
                $('#DivRptRights').hide();
            }
        });

    });
    //for report rights
    $(function () {
        $('#CheckAll2').on('change', function () {
            $('#checkBoxMessage span').text("");
            if ($(this).is(':checked')) {
                
                $('#checkBoxMessage span').text("");
                $('.All2').prop('checked', true);
                
                //$('#CheckAll2').prop('checked', true);
                //alert('checked');
            }
            else {
                
                $('.All2').prop('checked', false);
            }
        });
       
    });
    if(@ViewBag.LoanId.Items.Count==1){
        var loan = $('#LoanIdUser').val();
        SendParaTo(loan);
    }

    $('#LoanIdUser2').change(function () {
        $('#loanIdMessage span').text("");
        $('#selectAll').prop('checked', false);
        $('.All').prop('checked', false);
        $('#CheckAll2').prop('checked', false);
        $('.All2').prop('checked', false);
        $('#DivRptRights').hide();
    });
    $(function () {
        $('.All').on('change', function () {
            $('#checkBoxMessage span').text("");
            checkAll();
        });
    });
    //report rights section
    $(function () {
        $('.All2').on('change', function () {
            $('#checkBoxMessage span').text("");
            checkAll2();
        });
    });
    function checkAll(){
        var model = @Html.Raw(Json.Encode(Model));
        var len = model.UserRightsList.length;
        var count =0;
        for (var j = 0 ; j < model.UserRightsList.length; j++){
            var str = '#'+(j+1);
            if ($(str).is(':checked')) {
                //alert('checked');
                count++;
            }
        }
        if( title != 1 && hasFee === 1 && count === (len-1)){
            $('#CheckAll').prop('checked', true);
        }
        else if( title == 1 && hasFee != 1 && count === (len-1)){
            $('#CheckAll').prop('checked', true);
        }
        else if( title != 1 && hasFee != 1 && count === (len-2)){
            $('#CheckAll').prop('checked', true);
        }
        else if( count === len){
            $('#CheckAll').prop('checked', true);
        }
        else{
            $('#CheckAll').prop('checked', false);
        }
        $('#successSpn span').text("");
        $('#errSpn span').text("");
    };

    function checkAll2(){
        var model = @Html.Raw(Json.Encode(Model));
        var len = model.ReportRightsList.length;
        var count =0;
        var len2 = $('.All2').filter(function() {
            return $(this).css('display') !== 'none';
        }).length;
        for (var j = 0 ; j < model.ReportRightsList.length; j++){
            var str = '#'+ model.ReportRightsList[j].rightId;
            if ($(str).is(':checked')) {
                //alert('checked');
                count++;
            }
        }
        //alert(len2);
        if(count===len2){
           
            $('#CheckAll2').prop('checked', true);
        }
        else{
           
            $('#CheckAll2').prop('checked', false);
    }
       
        $('#successSpn span').text("");
        $('#errSpn span').text("");
    };
    $('#7').change(function(){
        if($(this).is(":checked")) {

            var loanId2 = 0;
            @if(ViewBag.LoanId!=null && ViewBag.LoanId.Items.Count == 1)
            {

                <text> loanId2 = @ViewBag.LoanId.Items[0].LoanId;</text>

            <text> CheckLoanReportRights(loanId);</text>
                <text>$('#DivRptRights').show();</text>
             }
             else{

                <text>loanId2 = $('#LoanIdUser2').val();</text>
                 <text> CheckLoanReportRights(loanId2);</text>
                <text>$('#DivRptRights').show();</text>

                 }



        }
        else{
            $('.CBAll2').prop('checked', false);
            $('.All2').prop('checked', false);
            $('#DivRptRights').hide();
        }
    });
    //report popup
    function ViewDetails(rightId){
        //alert(rightId);
        var model = @Html.Raw(Json.Encode(Model));
        $('#PopupDiv').show();
        showPopup('Rpt2');
        $('#textForPopup').text(model.ReportRightsList[rightId].name);
        $('#desLbl').text(model.ReportRightsList[rightId].description);
        var str = model.ReportRightsList[rightId].ImagePath;
        $('#idimg').attr('src',str);
    };
    </script>
<div id="PopupDiv">
    <div class="overlay-bg">
    </div>
    <div class="overlay-content popupRpt2" style="width:auto;text-align:center;margin-top:-131px;margin-left:-246px">
        <div class="close-pop icon-cross" style="float: right;font-size: 23px;"></div>
        <h3 id="textForPopup"></h3>
        <div style="padding:10px;">
            <label style="color:darkgreen;font-weight:bold">Description</label>
        </div>
        <div style="padding:10px;">
            <label id="desLbl"></label>
        </div>
        <div style="padding:10px;">
            <label style="color:darkgreen;font-weight:bold">Example</label>
        </div>
        <div style="padding: 10px;">
            <img onclick="window.open(this.src)" alt="Image" style="max-width: 1500px;max-height: 500px" id="idimg" />
        </div>
        <input type="button" class="close-btn btn btn-info" value="Close" style="margin-left:893px;"/>
    </div>

</div>

<script>

    // function to show our popups
    function showPopup(whichpopup) {
        var docHeight = $(document).height(); //grab the height of the page
        var scrollTop = $(window).scrollTop(); //grab the px value from the top of the page to where you're scrolling
        $('.overlay-bg').show().css({ 'height': docHeight }); //display your popup background and set height to the page height
        $('.popup' + whichpopup).show().css({ 'top': scrollTop + 20 + 'px' }); //show the appropriate popup and set the content 20px from the window top
    }

    // function to close our popups
    function closePopup() {
        $('.overlay-bg, .overlay-content').hide(); //hide the overlay
    }

    // timer if we want to show a popup after a few seconds.
    //get rid of this if you don't want a popup to show up automatically
    // setTimeout(function() {
    // Show popup3 after 2 seconds
    //    showPopup(3);
    // }, 2000);


    // show popup when you click on the link
    $('.show-popup').click(function (event) {
        //event.preventDefault(); // disable normal link function so that it doesn't refresh the page
        var selectedPopup = $(this).data('showpopup'); //get the corresponding popup to show

        showPopup(selectedPopup); //we'll pass in the popup number to our showPopup() function to show which popup we want
    });

    // hide popup when user clicks on close button or if user clicks anywhere outside the container
    $('.close-btn, .overlay-bg ,.close-pop').click(function () {
        closePopup();
    });

    // hide the popup when user presses the esc key
    $(document).keyup(function (e) {
        if (e.keyCode == 27) { // if user presses esc key
            closePopup();
        }
    });
</script>



