
<!DOCTYPE html>

<html>
<head>

    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <title>Setup Process - TFN Application</title>

    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">


    <link href="~/Content/bootstrap.min.css" rel="stylesheet" />
    <script src="~/scripts/jquery-1.10.2.min.js"></script>
    <script src="~/scripts/bootstrap.min.js"></script>

    <link href="~/Content/style.css" rel="stylesheet" />


    <link href="~/Content/pikaday.css" rel="stylesheet" />
    <link href="~/Content/theme.css" rel="stylesheet" />
    <link href="~/Content/triangle.css" rel="stylesheet" />
    <script src="~/scripts/moment.js"></script>
    <script src="~/scripts/pikaday.js"></script>
  

    <script src="~/Scripts/jquery-1.10.2.min.js"></script>
    <script src="~/Scripts/jquery.validate.min.js"></script>
    <script src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>
   @using BankLoanSystem.Models;
    <script>


        function handleError(ajaxContext) {


            //alert("Some thing went wrong... You have to Login again");
            window.location.href = "/Login/UserLogin";
        }

        function handleErrorMsg(ajaxContext) {

            var response = ajaxContext.statusText;
            //// var statusCode = response.get_statusCode();
            //if (response.indexOf("Session") > 0) {
            //   // alert("Some thing went wrong... You have to Login again");
            //    window.location.href = "/Login/UserLogin";
            //} else {
            //    alert(response);
            //}
            window.location.href = "/Login/UserLogin";
        }


        function updateContent(data) {
            if (data == null)
                return;
            var content = document.getElementById('changeContainer');
            content.innerHTML = data.Content;

        }



        // change Url
        //function onAjaxSuccess() {


        //    var array = $(this).attr('class').split(' ');

        //    var step = array[1];


            




        //}






        function globalProgress(step) {
            global = step;
        }
        function skipProgress(step) {
            if(global == 6)
            if (global < step) {
                gloal = step;
                Progress(step);
            }
        }

        function Progress(step) {

            if (typeof (history.pushState) != "undefined") {
                var obj = { Page: 'Step' + step, Url: 'Step' + step };
                //alert(obj.Content);
                history.pushState(obj, obj.Page, obj.Url);
            }

            if (global <= step){

            for (var i = 1; i <= step ; i++) {
                var tab = ".tab." + i;

                @if (((User)Session["AuthenticatedUser"]).RoleId == 2)
                {
                    <text>if (i <= 2) continue;
        
                </text>

                }
               
                 @if ((Session["isInterest"] != null ) && Convert.ToBoolean(Session["isInterest"]) == false)
                 {
                     <text>if (i == 7) continue;
        
                     </text>

                 }
                

                //if( global==6 && step== 8){

                //    if(i ==7 ) continue;
                //}

                $(tab).children("span").remove();
                $(tab).css("pointer-events", "auto").css("cursor", "pointer");
                if (i == step) {
                    $(tab).append("<span style='float:right;color:yellow'>&#x270E;  </span>");
                    $(tab).parent("li").addClass("active").siblings().removeClass('active');
                    if (i >= 6) {
                        $(".main-tab.2").removeClass('collapsed');
                        $("#demo2").addClass("in");
                        $('#demo').children('ul').children('li').removeClass('active');
                        $(".main-tab.1").addClass('collapsed');
                        $("#demo").removeClass("in").addClass("collapse");
                    } else {
                        $(".main-tab.1").removeClass('collapsed');
                        $("#demo").addClass("in");
                    }
                } else {
                    $(tab).append("<span style='float:right;color:green'>&#10004;  </span>");
                }
            }

            global = step;

            }


        }


        




    </script>


    <style>

        .text-danger{

                z-index: 10001;
    font-weight: bold;
    position: absolute;
    font-size: 12px;
        }
        body {
            background-color:#0A1219;
        }

        #changeContainer {
            padding: 20px 35px 20px 35px;
        }

        .nav-conatainer {
            float: left;
            width: 20%;
        }

        .nav.nav-pills.nav-stacked.secondary {
            padding-left: 25px;
        }

        .nav-bars {
        }



            .nav-bars.collapse.in {
            }


        .page-wrapper {
            width: 78%;
           
            float: right;
            background-color: #ebebed;
        }

        .in-container {
            float: right;
            width: 95%;
            margin-top: 20px;
            margin-right: 20px;
                margin-bottom: 20px;
            background-color: white;
        }


        .top-bar {
            float: right;
            width: 100%;
            height: 61px;
            background-color: rgb(51, 122, 183);
        }

            .top-bar > a {
                float: right;
                color: white;
                text-decoration: none;
                margin-top: 18px;
                margin-right: 20px;
            }

                

        .profile-elements {
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
        }

        .no-bullets {
            list-style-type: none;
        }

        .img-circle {
            border-radius: 50%;
        }

        .no-text-decoration {
            text-decoration: none;
        }

        .main-tab {
            border-bottom-right-radius: 1em;
            margin-bottom: 1px;
        }

        .input-validation-error {
            border: 1px solid #ff0000;
        }
         .valid{
             border: 1px solid green;
        }
         .field-validation-error{
             /*z-index:1000;
             background: #0A1219;
             width:270px;
             opacity: 0.9;
		padding: 1%;
		font-weight: bold;
		position: absolute;
		top: 0%;
		left: 100%;
		margin: 0 0 0 -20%; /* add negative left margin for half the width to center the div */
		/*cursor: default;
		
		border-radius: 4px;
		box-shadow: 0 0 5px rgba(0,0,0,0.9);*/
            
    z-index: 10001;
    font-weight: bold;
    position: absolute;
    font-size:12px;
         }

        .control-label {
            text-align: left !important;
         }

        .internal-panel{
                margin-top: 18px;
    border-radius: 25px;
    border: 2px solid rgb(136, 139, 158);
    padding: 20px;
    display: block;
        }

        .left-button{
            float:left;
            margin-left:15px;
        }
        .right-button{
            float:right;
            margin-right:15px;
        }
        .btn-next{
           
            margin: 0px -50px; width:100px;
            position:relative;
            top:50%; left:50%;
        }
        .button-panel{
                margin-top: 15px;
                width:85%;
        }
    </style>



</head>
<body>

    <div class="container">


        @{
            Html.RenderAction("SetupDashBoard", "SetupProcess");
        }


        <script>

            $(".tab").append("<span style='float:right'>&#128274;  </span>");
            $(".tab").css("pointer-events", "none").css("cursor", "default");

            $(".tab").click(function () {

                $(this).parent("li").addClass("active").siblings().removeClass('active');
                $(this).parent("li").parent("ul").parent("div").siblings("div").children("ul").children("li").removeClass('active');
            });

            $(".main-tab.1").click(function () {

                $(".main-tab.2").addClass('collapsed');
                $("#demo2").removeClass("in").addClass("collapse");
            });

            $(".main-tab.2").click(function () {

                $(".main-tab.1").addClass('collapsed');
                $("#demo").removeClass("in").addClass("collapse");
            });

            $(document).on('click', '.btnDeleteRow', function () {
             
        
                var tblLength = $('table#tblGrid > tbody > tr').not(':first').length;
                $('#customErrorTable').children('span').text("");
                alert(tblLength);
                if(tblLength > 1) {
            
                    var tr = $(this).parents('tr:first');

                    var curid = tr.find("#lblCur").html();
                    var timePeriod = tr.find("#timePeriod").val();
                    var percentage = tr.find("#percentage").val();

                    if (percentage !== '') {
                        var gridTable = document.getElementById('tblGrid');
                        gridTable.deleteRow(curid);
                        id = id - 1;

                        for (var k = curid; k < id + 1; k++) {
                            gridTable.rows[k].cells[0].innerHTML = '<label id="lblCur">' + k + '</label>';
                        }

                        var removeIndex = (parseInt(curid) - parseInt(1));

                        list.currentList.splice(removeIndex, 1);
                        var currentListLenght = Object.keys(list.currentList).length;

                        for (var i = removeIndex; i < currentListLenght; i++) {
                            list.currentList[i].CurtailmentId = removeIndex + 1;
                        }

                        //for (var j = 0; j < currentListLenght; j++) {
                        //    alert('curid:' + list.currentList[j].CurtailmentId + ' timePeriod:' + list.currentList[j].TimePeriod + ' percentage:' + list.currentList[j].Percentage);
                        //}

                        remainingPt = parseInt(remainingPt) + parseInt(percentage);

                        if(parseInt(remainingPt) > 0)
                        {
                            var val = document.getElementById('spnremainPtComplete').innerHTML;

                            $('#spnremainPt').text('Remaining Percentage:' + remainingPt);
                            $('#spnremainPtComplete').text('');
                            $('#spnremainPtError').text('');
                        }
                        else if (parseInt(remainingPt) === 0) {
                            $('#spnremainPt').text('');
                            $('#spnremainPtComplete').text('Curtailment schedule Completed.');
                            $('#spnremainPtError').text('');
                        } else {
                            $('#spnremainPt').text('');
                            $('#spnremainPtComplete').text('');
                            $('#spnremainPtError').text('Error percentage found');
                        }
                    }

                }

                //
                //var index = 0;

                //$('table#tblGrid > tbody > tr').not(':first').each(function() {

                //    var curid = $(this).find("#lblCur").html();
                //    var timePeriod = $(this).find("#timePeriod").val();
                //    var percentage = $(this).find("#percentage").val();
                //    var previousTime = 0;

                //    if(curid > 1)
                //        previousTime = list.currentList[curid - 2].TimePeriod;

                //    //alert('curid: ' + curid + ' timePeriod: ' + timePeriod);
                //    if (parseInt(timePeriod) > parseInt(remainingTime)) {
                //        $('#spnremainTimeError').children('span').text("You entered time should be less than paid off period");
                //        isErrorTime = true;
                //    }else if (parseInt(timePeriod) <= parseInt(previousTime) && parseInt(timePeriod) > 0) {
                //        $('#spnremainTimeError').children('span').text("You entered time should be greater than previous time");
                //        isErrorTime = true;
                //    }
                //    else {
                //        isErrorTime = false;
                //        $('#spnremainTimeError').children('span').text("");
                //    }

                //    // update list
                //    list.currentList[index].TimePeriod = timePeriod;
                //    list.currentList[index].Percentage = percentage;
                //    index = parseInt(index) + parseInt(1);
                //});

                var index = 0;

                $('table#tblGrid > tbody > tr').not(':first').each(function() {

                    var curid = $(this).find("#lblCur").html();
                    var timePeriod = $(this).find("#timePeriod").val();
                    var percentage = $(this).find("#percentage").val();
                    var previousTime = 0;

                    if (parseInt(curid) > 1) {
                        previousTime = list.currentList[curid - 2].TimePeriod;
                    }

                    var currentListLenght = Object.keys(list.currentList).length;
                    if (parseInt(curid) > 1 && parseInt(currentListLenght) > parseInt(index)) {
                        // update list
                        list.currentList[index].TimePeriod = timePeriod;
                        //list.currentList[index].Percentage = percentage;
                    }

                    index = parseInt(index) + parseInt(1);
                    //alert('curid: ' + curid + ' timePeriod: ' + timePeriod + ' previousTime: ' + previousTime);

                    if (parseInt(timePeriod) > parseInt(remainingTime)) {
                        $('#spnremainTimeError').children('span').text("You entered time should be less than paid off period");
                        isErrorTime = true;
                        return false;
                    }else if (parseInt(timePeriod) <= parseInt(previousTime) && parseInt(timePeriod) > 0) {

                        $('#spnremainTimeError').children('span').text("You entered time should be greater than previous time");
                        isErrorTime = true;
                        return false;
                    }
                    else {
                        isErrorTime = false;
                        $('#spnremainTimeError').children('span').text("");
                    }
                });

                //alert('curid:' + curid + ' timePeriod:' + timePeriod + ' percentage:' + percentage);
            });



            @if(Session["loanStep"] != null)
            {
                 <text>globalProgress( 5+  @(((LoanSetupStep)Session["loanStep"]).stepId));
                Progress(5+ @(((LoanSetupStep)Session["loanStep"]).stepId));</text>
            }else if(Session["companyStep"] != null) {
                <text>globalProgress(@Session["companyStep"]);
                Progress(@Session["companyStep"]);</text>
            }


        </script>

        <div class="page-wrapper">

            <div class="top-bar">@Html.ActionLink("Sign out", "UserLogin", "Login", null, new { @class = "btn btn-info" }) </div>

            <div class="in-container">
                <div id="loadingDiv" style="display:none">
                    @*<img src="~/Images/loading.gif" />*@
                </div>
                <div id="changeContainer" class="body-content">
                    <label id="successLabel">@ViewBag.SuccessMsg</label>
                    <label id="errorLabel">@ViewBag.ErrorMsg</label>
                    @RenderBody()
                </div>

            </div>
        </div>


    </div>


    <!-- Mainly scripts -->

    <script src="~/scripts/jquery.unobtrusive-ajax.min.js"></script>
 
</body>
</html>